<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="https://placehold.co/35x35/0000FF/FFFFFF?text=TV">
    <title>Shakzz TV</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- JW Player Script and Key -->
    <script src="https://ssl.p.jwpcdn.com/player/v/8.36.6/jwplayer.js"></script>
    <script>jwplayer.key = "ITWMv7t88JGzI0xPwW8I0+LveiXX9SWbfdmt0ArUSyc="</script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;700&display=swap');

        :root {
            --bg-color: #111;
            --text-color: white;
            --accent-color: royalblue;
            --header-height: 56px;
        }

        /* Basic Reset */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth; /* Enabled smooth scrolling for anchors/back-to-top */
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Montserrat', sans-serif;
            line-height: 1.7;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
        }

        ul {
            list-style: none;
        }

        a {
            text-decoration: none;
        }

        /* Container & Headings */
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 0 20px;
        }

        .lg-heading {
            font-size: 2.8rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        /* Page Header */
        .page-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background-color: var(--bg-color);
        }

        .top-nav {
            width: 100%;
            background-color: #000;
            border-bottom: 1px solid var(--accent-color);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: var(--header-height);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .nav-logo img {
            height: 35px;
            width: auto;
        }

        .logo-text {
            font-size: 1.4em;
            color: var(--accent-color);
            font-weight: bold;
        }

        .nav-pages,
        .nav-links {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        #viewerCounter {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
        }

        .nav-links a,
        .nav-pages a,
        .mobile-nav-pages a {
            font-weight: bold;
            text-transform: uppercase;
            color: #fff;
            padding: 8px 16px;
            transition: all 0.3s ease;
        }

        .nav-links a:hover,
        .nav-pages a:hover,
        .mobile-nav-pages a:hover {
            color: #0066ff;
            text-shadow: 0 0 8px rgba(0, 102, 255, 0.7);
            transform: scale(1.05);
        }

        /* Hamburger Menu */
        .hamburger {
            display: none;
            flex-direction: column;
            justify-content: space-around;
            width: 25px;
            height: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 110;
        }

        .hamburger span {
            display: block;
            height: 3px;
            width: 100%;
            background: var(--accent-color);
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -5px);
        }

        /* Mobile Menu */
        .mobile-nav-pages {
            display: flex;
            flex-direction: column;
            gap: 10px;
            background-color: #111;
            position: absolute;
            top: var(--header-height);
            right: 0;
            width: 180px;
            border-left: 1px solid #333;
            border-bottom: 1px solid #333;
            padding: 10px;
            transition: transform 0.3s ease, opacity 0.3s ease, visibility 0.3s ease;
            transform: translateY(-10px);
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            z-index: 99;
        }

        .mobile-nav-pages.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }


        /* Main Content */
        #main-content-area {
            display: flex;
            gap: 0;
            flex-grow: 1;
            height: calc(100vh - var(--header-height));
            margin-top: var(--header-height);
            overflow: hidden;
        }

        .main-player-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        #playerWrapper {
            position: relative;
            flex: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
        }

        #video {
            flex: 1;
            width: 100%;
            min-height: 0;
            background: black;
            position: relative;
            overflow: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            width: 400px; /* Adjusted for desktop view */
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            min-height: 0;
            background-color: #222;
            border-left: 2px solid #222;
            overflow-y: auto;
        }

        .scrollable-list {
            flex: 1;
            overflow-y: auto;
            background-color: #1a1a1a;
            min-height: 0;
            padding: 5px 10px;
        }

        .channel-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding: 5px 0;
        }


        /* Search */
        .search-container {
            position: relative;
            display: flex;
            align-items: center;
            margin: 20px 15px 10px; /* Adjusted for desktop view */
        }

        .search-container input {
            flex: 1;
            padding: 8px 30px 8px 12px; /* Adjusted for better vertical alignment */
            border-radius: 5px;
            border: 1px solid #2f2f2f;
            background-color: var(--bg-color);
            color: var(--text-color);
            width: 100%;
            font-size: 0.9rem;
        }

        #clearSearch {
            position: absolute;
            right: 12px;
            cursor: pointer;
            color: #ccc;
            font-weight: bold;
        }

        /* Category Bar */
        .category-bar {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 columns on desktop */
            gap: 10px;
            padding: 8px 10px;
            background-color: #1a1a1a;
            border-bottom: 1px solid #333;
        }

        .category-button {
            background: linear-gradient(135deg, #333, #444);
            color: #ccc;
            border: none;
            border-radius: 12px;
            padding: 8px 0;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.3s;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 38px;
            width: 100%;
            box-sizing: border-box;
        }

        .category-button:hover,
        .category-button.active {
            background: linear-gradient(135deg, royalblue, cyan);
            color: #fff;
            transform: scale(1.04);
            box-shadow: 0 0 8px rgba(0, 128, 255, 0.7), 0 0 15px rgba(0, 255, 255, 0.4);
        }


        /* Channel List */
        #channelCount {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            font-weight: bold;
            font-size: 0.85rem;
            background-color: #1a1a1a;
            border-bottom: 1px solid #333;
        }

        .channel-button {
            width: 100%;
            padding: 10px 12px; /* Adjusted for desktop view */
            background-color: #2b2b2b;
            border: 1px solid transparent;
            border-radius: 6px;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s, transform 0.3s;
            font-size: 0.95rem; /* Adjusted for desktop view */
        }

        .channel-button:hover {
            background-color: #333;
            border-color: var(--accent-color);
            transform: scale(1.02);
        }

        .channel-name {
            flex-grow: 1;
            white-space: normal;
            text-align: left;
            line-height: 1.4;
            min-width: 0;
        }

        .channel-logo {
            width: 30px;
            height: 30px;
            object-fit: contain;
            border-radius: 4px;
            background-color: white;
            flex-shrink: 0;
        }

        /* About & Contact */
        .info-section {
            padding: 4rem 20px;
            scroll-margin-top: var(--header-height);
            overflow: hidden; /* Important for scroll reveal to work correctly with translateX/Y */
        }

        .info-section h2 {
            color: var(--accent-color);
            margin-bottom: 2rem;
        }

        .info-section h3 {
            font-size: 1.6rem;
            margin: 1.8rem 0 1rem;
            color: var(--accent-color);
        }

        .info-section p {
            margin-bottom: 1.2rem;
            font-size: 1rem;
            color: #ccc;
        }

        .about-wrapper {
            display: flex;
            justify-content: space-between;
            gap: 2rem;
            margin: 2rem 0 4rem;
        }

        #contact.info-section {
            padding: 2rem 15px;
            flex-grow: 0;
            border-top: none;
            padding-bottom: 3rem;
        }

        .contact-container {
            display: flex;
            flex-wrap: nowrap; /* Adjusted for desktop view */
            gap: 4rem; /* Adjusted for desktop view */
            justify-content: center;
            align-items: stretch;
        }

        .contact-social {
            flex: 1;
            min-width: 400px; /* Adjusted for desktop view */
            flex-shrink: 0; /* Adjusted for desktop view */
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .contact-social h2.lg-heading {
            line-height: 1.1;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .contact-social p {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .contact-social .contact-links {
            margin-top: 0;
            margin-bottom: 1rem;
        }

        /* --- SOCIAL LINKS COMPACT --- */
        .contact-links {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        /* --- DONATION SECTION --- */
        .donation-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            margin-top: 0.5rem;
        }

        .donation-info .donation-text,
        .donation-info .donation-guide {
            font-size: 0.9rem;
            color: #ccc;
            line-height: 1.7; /* FIX: Increased for better readability on mobile */
            text-align: center;
            margin: 0;
        }

        .qr-zoom-text {
            font-size: 0.8rem;
            font-style: italic;
            color: #aaa;
            margin-top: 4px;
        }

        /* Contact Form */
        .contact-form {
            flex: 1;
            min-width: 300px;
        }

        .contact-form label {
            display: block;
            margin-top: 10px;
            font-size: 1.1rem;
            text-align: left;
        }

        .contact-form input,
        .contact-form textarea {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            border-radius: 5px;
            border: 1px solid #333;
            background-color: #1a1a1a;
            color: #fff;
            font-size: 1rem;
        }

        .contact-form button {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            background-color: var(--accent-color);
            color: #fff;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 1rem;
            margin-top: 20px;
        }

        .contact-form button:hover {
            background-color: #0066ff;
        }

        /* Footer */
        .copyright-text {
            text-align: center;
            margin-top: 3rem;
            color: #888;
        }

        /* Utility Class */
        .no-wrap {
            white-space: nowrap;
        }


        /* --- MODAL (UPDATED) --- */
        .modal-overlay {
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.active {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background: #111;
            color: #fff;
            padding: 20px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
            box-shadow: 0 0 15px rgba(0, 102, 255, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 12px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #fff;
            transition: transform 0.2s ease, color 0.2s ease;
            z-index: 10;
        }

        .close-button:hover {
            transform: scale(1.2);
            color: var(--accent-color);
        }

        .modal-heading {
            margin-top: 10px;
            margin-bottom: 10px;
            color: royalblue;
            font-size: 1.6rem;
        }

        .modal-text {
            margin: 5px 0;
            font-size: 1rem;
            line-height: 1.5;
        }

        .modal-countdown {
            margin-top: 8px;
            font-size: 0.9rem;
            color: #ccc;
            font-style: italic;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Back-to-Top */
        #backToTopBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1500;
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 8px;
            background: var(--accent-color);
            color: #fff;
            cursor: pointer;
            font-size: 22px;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            transition: opacity 0.3s ease, transform 0.3s ease;
            opacity: 0;
        }

        #backToTopBtn.show {
            display: flex;
            opacity: 1;
        }

        #backToTopBtn:hover {
            transform: scale(1.1);
        }

        /* Rainbow Text */
        .rainbow-text {
            font-weight: bold;
            background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbow 6s ease infinite;
        }

        @keyframes rainbow {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* --- QR CODE MODAL & CLICKABILITY (UPDATED) --- */
        .donation-qr-code {
            max-width: 200px;
            height: auto;
            border-radius: 6px;
            background-color: white;
            margin-top: 4px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .donation-qr-code:hover {
            transform: scale(1.05);
        }

        .qr-modal-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 500px;
            width: 90%;
            position: relative;
        }

        #zoomedQrImage {
            width: 100%;
            height: auto;
            display: block;
        }

        #qrModal .close-button {
            top: -15px;
            right: -15px;
            color: white;
            background: rgba(0, 0, 0, 0.6);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            font-size: 24px;
            text-shadow: none;
        }

        /* Adjust "Now Playing" text font size */
        .now-playing-text {
            font-size: 1rem;
        }

        @media (max-width: 420px) {
            .modal-heading {
                font-size: 1.3rem;
                white-space: nowrap;
            }
        }

        /* --- FAVORITES STAR --- */
        .favorite-star {
            font-size: 1.2rem;
            margin-left: auto;
            cursor: pointer;
            transition: transform 0.2s ease, color 0.2s ease;
            user-select: none;
        }

        .favorite-star:hover {
            transform: scale(1.2);
            color: gold;
            text-shadow: 0 0 8px gold;
        }

        .favorite-star.active {
            color: gold;
            text-shadow: 0 0 10px gold;
        }

        #clearFavoritesBtn {
            display: none;
            margin: 10px auto;
            padding: 10px 14px;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-color, white);
            background: var(--accent-color, royalblue);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 50%;
            max-width: 180px;
            text-align: center;
            box-shadow: 0 0 10px rgba(65, 105, 225, 0.4);
        }

        #clearFavoritesBtn:hover {
            background: #ff4c4c;
            box-shadow: 0 0 12px rgba(255, 76, 76, 0.6);
            transform: scale(1.05);
        }

        #clearFavoritesBtn:active {
            transform: scale(0.97);
        }

        /* --- Mobile Responsive Overrides --- */
        @media (max-width: 992px) {
            #main-content-area {
                flex-direction: column;
                height: auto;
                flex-grow: 1;
                margin-bottom: 2rem;
            }
            #video {
                height: auto;
                aspect-ratio: 16/9;
            }
            .sidebar {
                width: 100%;
                max-height: unset;
                border-left: none;
                border-top: 2px solid #222;
                overflow: hidden;
            }
            .scrollable-list {
                max-height: 58vh;
            }
            .about-wrapper {
                flex-direction: column;
            }
            .search-container {
                margin: 10px;
            }
        }

        @media (max-width: 768px) {
            .page-header {
                position: static;
            }
            #main-content-area {
                margin-top: 0;
            }
            .nav-pages {
                display: none;
            }
            .hamburger {
                display: flex;
            }
            .nav-links .click-here-link {
                display: none;
            }
            .contact-container {
                flex-direction: column;
                align-items: center;
                gap: 20px; /* Reset gap for mobile */
            }
            .category-bar {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px; /* Reset gap for mobile */
            }
            .info-section {
                scroll-margin-top: 20px;
            }
            .contact-social,
            .contact-form {
                min-width: unset;
                width: 100%;
            }
        }

        /* Get in Touch section spacing */
        #contact {
            padding-top: 30px;
        }

        #contact .contact-social .lg-heading {
            line-height: 1.1;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .neon-bubble {
            font-size: 2.5rem;
            color: #fff;
            text-shadow: 0 0 5px #00bfff;
            display: inline-block;
            position: relative;
            animation: floatBubble 6s ease-in-out infinite;
            transition: all 0.3s ease;
        }

        .neon-bubble:hover {
            color: #00ffff;
            text-shadow: 0 0 12px #00ffff, 0 0 15px #00bfff;
            transform: scale(1.4) rotate(-10deg);
        }

        @keyframes floatBubble {
            0% {
                transform: translateY(0);
            }
            25% {
                transform: translateY(-8px) rotate(-3deg);
            }
            50% {
                transform: translateY(-16px) rotate(3deg);
            }
            75% {
                transform: translateY(-8px) rotate(-3deg);
            }
            100% {
                transform: translateY(0);
            }
        }

        /* --- Universal Notification Banner --- */
        .notification-banner {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%) translateY(-40px);
            width: 92%;
            padding: 12px 16px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 600;
            font-size: 0.95rem;
            color: white;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.35s ease, transform 0.35s ease;
            background-color: rgba(0, 0, 0, 0.85); /* fallback only */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 18px rgba(0, 0, 0, 0.6);
        }

        /* Show / Hide Animation */
        .notification-banner.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
            pointer-events: auto;
        }

        .notification-banner.hide {
            opacity: 0;
            transform: translateX(-50%) translateY(-40px);
            pointer-events: none;
        }

        /* --- Type Variants (Gradient restored for all devices) --- */
        .notification-banner.info {
            background-image: linear-gradient(90deg, #00bcd4 0%, #2196f3 100%);
        }

        .notification-banner.success {
            background-image: linear-gradient(90deg, #43a047 0%, #2e7d32 100%);
        }

        .notification-banner.alert {
            background-image: linear-gradient(90deg, #ff7043 0%, #e53935 100%);
        }

        /* --- Content --- */
        .notification-content {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .notification-content i {
            font-size: 1.1rem;
        }

        /* --- Close Button --- */
        .close-notification-btn {
            background: none;
            border: none;
            color: inherit;
            font-size: 1.3rem;
            cursor: pointer;
            transition: transform 0.2s;
            flex-shrink: 0;
        }

        .close-notification-btn:hover {
            transform: scale(1.2);
        }

        /* --- TV Remote Focus Glow (soft blue ring) --- */
        .focused {
            outline: 3px solid #00aaff;
            box-shadow: 0 0 14px #00aaff;
            border-radius: 8px;
            transition: box-shadow 0.12s, outline 0.12s, transform 0.08s;
            transform: translateZ(0);
            z-index: 99999;
        }

        /* Slight focus scale so TV remote feels responsive */
        .focused.scale {
            transform: scale(1.02);
        }

        /* Make focusable elements visibly focusable for mouse users too */
        button:focus, a:focus, input:focus, textarea:focus {
            outline: none;
        }

        /* Ensure modal focus is obvious */
        .modal-overlay .focused {
            outline-color: #00aaff;
            box-shadow: 0 0 18px #00aaff;
        }
        
        /* --- SCROLL REVEAL CSS ADDITIONS: Directional Fade-In --- */
        
        /* Base hidden state and transition (APPLES TO ALL .scroll-reveal) */
        .scroll-reveal {
            opacity: 0;
            transition: opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* INCREASED TIME */
            will-change: opacity, transform;
            /* FIX: Ensure element is visually hidden until activated, fixing the visibility bug */
            visibility: hidden; 
        }
        
        /* 1. Pop-Up Animation (FOR MAIN SECTION HEADINGS - h2, and entire section wrapper) */
        .info-section > .container > .lg-heading.scroll-reveal,
        .contact-social > .lg-heading.scroll-reveal,
        .info-section.scroll-reveal {
            transform: translateY(20px) scale(0.98); 
        }

        /* 2. Alternating Slide Animation (FOR ALL DIRECT CHILD ELEMENTS OF .container EXCEPT h2) */
        .info-section > .container > .scroll-reveal:not(.lg-heading), 
        .contact-social > .scroll-reveal:not(.lg-heading), /* Target p, h3, ul inside contact-social */
        .contact-form form > * /* Target direct children of the form */
        {
            /* Default to sliding from left */
            transform: translateX(-80px); /* INCREASED DISTANCE */
            opacity: 0;
            transition: opacity 0.8s ease-out, transform 0.8s ease-out; /* INCREASED TIME */
        }

        /* Slide from Right (Even-numbered direct children of the container/form) */
        /* This creates the alternating L-R-L-R effect */
        .info-section > .container > .scroll-reveal:not(.lg-heading):nth-child(even),
        .contact-form form > *:nth-child(even) {
            transform: translateX(80px); /* INCREASED DISTANCE */
        }

        /* Active State: Reset transform and opacity */
        .scroll-reveal.active {
            opacity: 1;
            transform: translate(0, 0) scale(1); /* Reset transform (slide/pop-up) and scale */
            /* FIX: Ensure element is visible after activation */
            visibility: visible;
        }
        
        /* Staggered Delay for Sub-elements in About/Privacy sections */
        .info-section.scroll-reveal.active > .container > *:nth-child(2) { transition-delay: 0.2s; }
        .info-section.scroll-reveal.active > .container > *:nth-child(3) { transition-delay: 0.3s; }
        .info-section.scroll-reveal.active > .container > *:nth-child(4) { transition-delay: 0.4s; }
        .info-section.scroll-reveal.active > .container > *:nth-child(5) { transition-delay: 0.5s; }
        .info-section.scroll-reveal.active > .container > *:nth-child(6) { transition-delay: 0.6s; }
        .info-section.scroll-reveal.active > .container > *:nth-child(7) { transition-delay: 0.7s; }
        .info-section.scroll-reveal.active > .container > *:nth-child(8) { transition-delay: 0.8s; }
        .info-section.scroll-reveal.active > .container > *:nth-child(9) { transition-delay: 0.9s; }
        .info-section.scroll-reveal.active > .container > *:nth-child(10) { transition-delay: 1.0s; }
        .info-section.scroll-reveal.active > .container > *:nth-child(11) { transition-delay: 1.1s; }
        .info-section.scroll-reveal.active > .container > *:nth-child(12) { transition-delay: 1.2s; }
        
        /* Custom staggering for contact form children (L, R, L, R...) */
        .contact-form form > .scroll-reveal:nth-child(1) { transition-delay: 0.2s; } /* Label 1 (L) */
        .contact-form form > .scroll-reveal:nth-child(2) { transition-delay: 0.3s; } /* Input 1 (R) */
        .contact-form form > .scroll-reveal:nth-child(3) { transition-delay: 0.4s; } /* Label 2 (L) */
        .contact-form form > .scroll-reveal:nth-child(4) { transition-delay: 0.5s; } /* Input 2 (R) */
        .contact-form form > .scroll-reveal:nth-child(5) { transition-delay: 0.6s; } /* Label 3 (L) */
        .contact-form form > .scroll-reveal:nth-child(6) { transition-delay: 0.7s; } /* Input 3 (R) */
        .contact-form form > .scroll-reveal:nth-child(7) { transition-delay: 0.8s; } /* Button (L) */


        /* Staggered updates section (Kept the original, separate stagger for complexity) */
        .updates-scroll-container .update-item {
              opacity: 0;
              transform: translateY(20px);
              transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .info-section.scroll-reveal.active .update-item {
              opacity: 1;
              transform: translateY(0);
        }
        
        /* Apply a slight stagger to the update items based on their position */
        .info-section.scroll-reveal.active .update-item:nth-child(1) { transition-delay: 0.2s; }
        .info-section.scroll-reveal.active .update-item:nth-child(2) { transition-delay: 0.3s; }
        .info-section.scroll-reveal.active .update-item:nth-child(3) { transition-delay: 0.4s; }
        .info-section.scroll-reveal.active .update-item:nth-child(4) { transition-delay: 0.5s; }
        .info-section.scroll-reveal.active .update-item:nth-child(5) { transition-delay: 0.6s; }
        .info-section.scroll-reveal.active .update-item:nth-child(6) { transition-delay: 0.7s; }
        .info-section.scroll-reveal.active .update-item:nth-child(7) { transition-delay: 0.8s; }
        .info-section.scroll-reveal.active .update-item:nth-child(8) { transition-delay: 0.9s; }
        .info-section.scroll-reveal.active .update-item:nth-child(9) { transition-delay: 1.0s; }
        .info-section.scroll-reveal.active .update-item:nth-child(10) { transition-delay: 1.1s; }
        .info-section.scroll-reveal.active .update-item:nth-child(11) { transition-delay: 1.2s; }
    </style>
    </head>
<body>
    <header class="page-header">
        <nav class="top-nav">
            <div class="nav-left">
                <div class="nav-logo" onclick="location.reload()">
                    <img src="https://placehold.co/35x35/0000FF/FFFFFF?text=TV" alt="Logo">
                    <span class="logo-text">Shakzz TV</span>
                </div>
                <div class="nav-pages">
                    <a href="#about-us" class="focusable-element" tabindex="0">About</a>
                    <a href="#updates" class="focusable-element" tabindex="0">Updates</a>
                    <a href="#privacy-policy" class="focusable-element" tabindex="0">Privacy</a>
                    <a href="#contact" class="focusable-element" tabindex="0">Contact</a>
                </div>
            </div>
            <div class="nav-links">
                <div id="viewerCounter">
                    <i class="fas fa-eye"></i>
                    <span id="viewerCountText">0</span>
                </div>
                <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target="_blank" class="click-here-link focusable-element" tabindex="0">CLICK HERE</a>
                <div class="hamburger focusable-element" id="hamburger" tabindex="0">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </nav>
        <div class="mobile-nav-pages" id="navPages">
            <a href="#about-us" class="focusable-element" tabindex="0">About</a>
            <a href="#updates" class="focusable-element" tabindex="0">Updates</a>
            <a href="#privacy-policy" class="focusable-element" tabindex="0">Privacy</a>
            <a href="#contact" class="focusable-element" tabindex="0">Contact</a>
            <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target="_blank" class="click-here-link focusable-element" tabindex="0">CLICK HERE</a>
        </div>
    </header>

    <div id="liveNotificationBanner" class="notification-banner info hide">
        <div class="notification-content">
            <i class="fas fa-broadcast-tower"></i>
            <span id="notificationMessage">ðŸŽ¥ LIVE: We've just added 5 new channels to the 'Movies' category!</span>
        </div>
        <button id="closeNotificationBtn" class="close-notification-btn focusable-element" tabindex="0">&times;</button>
    </div>

    <section id="main-content-area">
        <div class="main-player-section">
            <div id="playerWrapper" style="position: relative;">
                <!-- The JW Player container is now focusable for TV Remote mode -->
                <div id="video" class="focusable-element" tabindex="0"></div> 
                <div id="overlayContainer" style="
                    position: absolute;
                    top: 10px;
                    left: 0;
                    right: 0;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 0 15px;
                    z-index: 10;">
                    <div id="nowPlayingOverlay" style="
                        padding: 6px 14px;
                        font-weight: bold;
                        font-size: 0.85rem;
                        color: #fff;
                        text-shadow: 0 0 6px rgba(0,0,0,0.7);
                        background: rgba(0, 0, 0, 0.4);
                        backdrop-filter: blur(4px);
                        border-radius: 8px;">
                        Now Playing: <span id="nowPlayingChannel">--</span>
                    </div>
                </div>
            </div>
            <div id="channelInfo"></div>
        </div>

        <div class="sidebar">
            <div class="search-container">
                <input type="text" id="search" placeholder="Search channel..." class="focusable-element" tabindex="0">
                <span id="clearSearch" class="clear-btn focusable-element" tabindex="0">Ã—</span>
            </div>

            <div class="category-bar">
            </div>

            <button id="clearFavoritesBtn" class="clear-fav-btn focusable-element" style="display:none;" tabindex="0">
                <i class="fas fa-trash"></i> Clear Favorites
            </button>

            <div id="channelCount" class="rainbow-text">
                <i class="fas fa-tv"></i>
                <span id="channelCountText">0 channels found</span>
            </div>

            <div class="scrollable-list">
                <div class="channel-list" id="channelList">
                </div>
            </div>
        </div>
    </section>

    <section id="about-us" class="info-section scroll-reveal">
        <div class="container">
            <h2 class="lg-heading scroll-reveal">About Shakzz TV</h2>
            <p class="scroll-reveal">Shakzz TV delivers a premier, curated portfolio of local and international networks, providing a seamless, high-quality streaming experience available 24/7. Our platform offers a comprehensive spectrum of programming designed to cater to every interestâ€”from breaking news and live sports to insightful documentaries and engaging animation.</p>
            
            <h3 class="scroll-reveal">Our Vision & Commitment</h3>
            <p class="scroll-reveal">To become the go-to free streaming service for Filipinos everywhere, bridging distances by providing a reliable and comprehensive source of local and international content. We envision a platform where every user feels connected to home, informed about the world, and entertained without barriers. We are committed to delivering a stable and high-quality streaming experience. This means continuously optimizing our platform for minimal buffering, expanding our channel lineup based on viewer feedback, and ensuring our service remains accessible and easy to use for everyone, on any device.</p>
            
            <h3 class="scroll-reveal">The 'Why': A Note from the Creator</h3>
            <p class="scroll-reveal">Shakzz TV was born from a simple idea: everyone deserves easy access to the channels they love, especially those that connect them to news, culture, and entertainment from home. As a passionate developer and media enthusiast, I created this platform to solve the common frustration of unreliable streams and scattered content. This project is a labor of love, dedicated to providing a seamless and free service for the community.</p>
        </div>
    </section>

    <section id="updates" class="info-section bg-dark scroll-reveal">
        <div class="container">
            <h2 class="lg-heading scroll-reveal">Latest Updates</h2>
            <div class="updates-scroll-container">
                <div class="update-item">
                    <h3>Live Notification <span class="update-date">[2025-11-08]</span></h3>
                    <p>Weâ€™ve introduced a new <strong>Live Notification System</strong> that allows instant announcements right inside the app! Notifications can now appear on-screen for important updates like new channels, live events, or maintenance alerts â€” without needing to refresh the page.</p>
                </div>

                <div class="update-item">
                    <h3>TV Remote Compatibility <span class="update-date">[2025-11-08]</span></h3>
                    <p>Shakzz TV web app is now fully <strong>Smart TV compatible!</strong> You can navigate the entire interface using your remoteâ€™s arrow keys, press <strong>Enter</strong> to play channels instantly, and use <strong>Back</strong> or <strong>Esc</strong> to close menus or modals.</p>
                    <p>Supported platforms include <strong>Android TV, Fire TV, Tizen,</strong> and <strong>WebOS</strong>. Plus, youâ€™ll enjoy smoother transitions and a new soft blue focus glow for clearer navigation.</p>
                </div>

                <div class="update-item">
                    <h3>Newly Added Feature: Favorites <span class="update-date">[2025-10-07]</span></h3>
                    <p>You can now mark your favorite channels with a star! Easily access them from the "Favorites" tab in the sidebar for quick viewing.</p>
                </div>

                <div class="update-item">
                    <h3>Now Playing Display <span class="update-date">[2025-10-07]</span></h3>
                    <p>You'll now see a "Now Playing" overlay at the top of the player, telling you exactly which channel is currently live. No more guessing!</p>
                </div>

                <div class="update-item">
                    <h3>New Channels Added! <span class="update-date">[2025-10-07]</span></h3>
                    <p>Our library is growing! We've just added 7 new international and local channels, bringing our total to 124. Discover them in the sidebar!</p>
                </div>

                <div class="update-item">
                    <h3>Major Platform Upgrade <span class="update-date">[2025-09-24]</span></h3>
                    <p>We've rolled out a significant update to improve streaming stability, reduce buffering, and enhance overall performance across all devices. Enjoy a smoother viewing experience!</p>
                </div>

                <div class="update-item">
                    <h3>New Channels Added! <span class="update-date">[2025-09-24]</span> </h3>
                    <p>We've expanded our library with 07 new international and local channels. Check them out in the sidebar category list.</p>
                </div>

                <div class="update-item">
                    <h3>Mobile UI Overhaul <span class="update-date">[2025-08-24]</span></h3>
                    <p>Our website is now fully responsive and optimized for mobile devices. The new layout ensures a great viewing experience whether you're on a desktop, tablet, or smartphone.</p>
                </div>

                <div class="update-item">
                    <h3>Search and Filtering Added <span class="update-date">[2025-07-24]</span></h3>
                    <p>Finding your favorite channel is now easier than ever! We've implemented a brand new search bar and category filters in the sidebar to help you navigate our growing channel list.</p>
                </div>

                <div class="update-item">
                    <h3>Official Launch <span class="update-date">[2025-07-24]</span></h3>
                    <p>Welcome to Shakzz TV! After months of development, our platform is now live. We're excited to provide a free, high-quality streaming service for everyone.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="privacy-policy" class="info-section scroll-reveal">
        <div class="container">
            <h2 class="lg-heading scroll-reveal">Privacy Policy</h2>
            <p class="scroll-reveal">At Shakzz TV, your privacy is paramount. This policy outlines how we collect, use, and protect your information. By using our service, you agree to the collection and use of information in accordance with this policy.</p>
            
            <h3 class="scroll-reveal">Information We Collect</h3>
            <p class="scroll-reveal">We collect non-personally identifiable information such as viewing habits, device type, browser information, and generalized location data to improve our service. We do not collect names, emails, or other direct personal identifiers without explicit consent.</p>
            
            <h3 class="scroll-reveal">How We Use Information</h3>
            <ul class="scroll-reveal">
                <li>Analyzing usage trends to enhance user experience.</li>
                <li>Optimizing streaming performance for different devices and regions.</li>
                <li>Understanding content popularity to guide channel acquisition.</li>
                <li>Troubleshooting technical issues and ensuring platform stability.</li>
            </ul>
            
            <h3 class="scroll-reveal">Data Security</h3>
            <p class="scroll-reveal">We implement reasonable safeguards to prevent unauthorized access, use, or disclosure of collected data.</p>
            
            <h3 class="scroll-reveal">Third-Party Services</h3>
            <p class="scroll-reveal">Our service uses third-party providers such as JW Player for streaming. They may collect data under their own policies. We do not share direct personal information.</p>
            
            <h3 class="scroll-reveal">Changes to This Policy</h3>
            <p class="scroll-reveal">We may update this policy periodically. Users will be notified of significant changes by posting them on this page.</p>
        </div>
    </section>

    <section id="contact" class="info-section bg-dark scroll-reveal">
        <div class="container contact-container">
            
            <div class="contact-social">
                <h2 class="lg-heading scroll-reveal">Get in Touch</h2>
                <p class="scroll-reveal">Connect with us on social media:</p>
                <div class="contact-links scroll-reveal">
                    <a href="https://facebook.com/profile.php?id=100083316728361" target="_blank" class="social-link neon-bubble focusable-element" tabindex="0">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://youtube.com/@Shakzz05" target="_blank" class="social-link neon-bubble focusable-element" tabindex="0">
                        <i class="fab fa-youtube"></i>
                    </a>
                </div>
                <div class="donation-info">
                    <p class="donation-text scroll-reveal">Your support helps keep this site running. Scan to donate via Gcash, Maya, or BPI. Need help scanning? Search for a QR tutorial on YouTube.</p>
                    <img src="https://placehold.co/200x200/FFFFFF/000000?text=SCAN+TO+DONATE" alt="BPI QR Code for Donations" class="donation-qr-code scroll-reveal focusable-element" id="qrImage" tabindex="0">
                    <p class="qr-zoom-text scroll-reveal">Click picture to zoom</p>
                </div>
            </div>
            
            <div class="contact-form">
                <form id="contactForm" action="https://formspree.io/f/manpwdko" method="POST">
                    <label for="name" class="scroll-reveal">Title / Name:</label>
                    <input type="text" id="name" name="name" placeholder="Your name or title" required class="focusable-element scroll-reveal" tabindex="0">
                    
                    <label for="email" class="scroll-reveal">Email Address:</label>
                    <input type="email" id="email" name="email" placeholder="Your email" required class="focusable-element scroll-reveal" tabindex="0">
                    
                    <label for="message" class="scroll-reveal">Description / Message:</label>
                    <textarea id="message" name="message" rows="5" placeholder="Write your message here..." required class="focusable-element scroll-reveal" tabindex="0"></textarea>
                    
                    <button type="submit" class="focusable-element scroll-reveal" tabindex="0">Send</button>
                </form>
            </div>
        </div>
        <p class="copyright-text">Â© 2025 Shakzz TV. All rights reserved. User ID: <span id="displayUserId">...</span></p>
    </section>

    <div id="welcomeModal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-countdown" id="modalCountdown">5</span>
            <span class="close-button focusable-element" id="closeModalBtn" tabindex="0">Ã—</span>
            <h2 class="modal-heading">Welcome to Shakzz TV!</h2>
            <p class="modal-text">Enjoy a curated selection of local and international channels, available 24/7.</p>
        </div>
    </div>

    <div id="qrModal" class="modal-overlay">
        <div class="modal-content qr-modal-content">
            <span class="close-button focusable-element" id="closeQrModalBtn" tabindex="0">Ã—</span>
            <img src="https://placehold.co/500x500/FFFFFF/000000?text=SCAN+TO+DONATE" alt="Zoomed QR Code" id="zoomedQrImage">
        </div>
    </div>

    <button id="backToTopBtn" title="Go to top" class="focusable-element" tabindex="0"><i class="fas fa-arrow-up"></i></button>

    <script type="module">
        // This script block now contains the full application logic.
        
        const channels = {
            PBBMain: {
                name: "PBB Main",
                type: "clearkey",
                manifestUri: "https://cdn-uw2-prod.tsv2.amagi.tv/linear/amg01006-abs-cbn-pbb-live-dash-abscbnono/index.mpd",
                logo: "https://i.imgur.com/n5rdR3v.png",
                group: ["entertainment"],
            },

            PBBDiningArea: {
                name: "PBB Dining Area",
                type: "clearkey",
                manifestUri: "https://abslive.akamaized.net/dash/live/2028025/pbb1/manifest.mpd",
                logo: "https://i.imgur.com/n5rdR3v.png",
                keyId: "b37bb823fe48452eba8cee62516f5da1",
                key: "8b48cec6bce94917e4c39c381d607102",
                group: ["entertainment"],
            },

            PBBPoolArea: {
                name: "PBB Pool Area",
                type: "clearkey",
                manifestUri: "https://abslive.akamaized.net/dash/live/2028025/pbb2/manifest.mpd",
                logo: "https://i.imgur.com/n5rdR3v.png",
                keyId: "9539027a7c42446a8648555af3bb3095",
                key: "1cb94c88f68bef1e728cfa4677e1eeca",
                group: ["entertainment"],
            },

            discoveryscience: {
                name: "Discovery Science",
                type: "clearkey",
                manifestUri: "https://d1g8wgjurz8via.cloudfront.net/bpk-tv/Discoveryscience2/default/manifest.mpd",
                keyId: "5458f45efedb4d6f8aa6ac76c85b621b",
                key: "dbf8a0a306a64525ba3012fd225370c0",
                logo: " https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSkA_8vr9UZUhtkaFi6AshM83zQwhPWBGWX-Q&s",
                group: ["documentary"],
            },
            KidoodleTV: {
                name: "Kidoodle TV",
                type: "hls",
                manifestUri: "https://amg07653-apmc-amg07653c5-samsung-ph-8539.playouts.now.amagi.tv/playlist.m3u8",
                logo: "https://d1iiooxwdowqwr.cloudfront.net/pub/appsubmissions/20201230211817_FullLogoColor4x.png",
                group: ["cartoons & animations"],
            },
            StrawberryShortcake: {
                name: "Strawberry Shortcake",
                type: "hls",
                manifestUri: "https://d1si3n1st4nkgb.cloudfront.net/10000/88258006/hls/master.m3u8?ads.xumo_channelId=88258006",
                logo: "https://upload.wikimedia.org/wikipedia/en/f/ff/Strawberry_Shortcake_2003_Logo.png",
                group: ["cartoons & animations"],
            },
            SonictheHedgehog: {
                name: "Sonic the Hedgehog",
                type: "hls",
                manifestUri: "https://d1si3n1st4nkgb.cloudfront.net/10000/88258004/hls/master.m3u8?ads.xumo_channelId=88258004",
                logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1f/Sonic_The_Hedgehog.svg/1200px-Sonic_The_Hedgehog.svg.png",
                group: ["cartoons & animations"],
            },
            SuperMario: {
                name: "Super Mario",
                type: "hls",
                manifestUri: "https://d1si3n1st4nkgb.cloudfront.net/10000/88258005/hls/master.m3u8?ads.xumo_channelId=88258005",
                logo: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRFkMkkUmZBGslGWGZMN2er5emlnqGCCU49wg&s",
                group: ["cartoons & animations"],
            },
            Teletubbies: {
                name: "Teletubbies",
                type: "hls",
                manifestUri: "https://d1si3n1st4nkgb.cloudfront.net/10000/88258003/hls/master.m3u8?ads.xumo_channelId=88258003",
                logo: "https://upload.wikimedia.org/wikipedia/en/thumb/5/5a/Teletubbies_Logo.png/330px-Teletubbies_Logo.png",
                group: ["cartoons & animations"],
            },
            anione: {
                name: "Ani One",
                type: "hls",
                manifestUri: "https://amg19223-amg19223c9-amgplt0019.playout.now3.amagi.tv/playlist/amg19223-amg19223c9-amgplt0019/playlist.m3u8",
                logo: "https://www.medialink.com.hk/img/ani-one-logo.jpg",
                group: ["cartoons & animations"],
            },
            
            jeepneytv: {
                name: "Jeepney TV",
                type: "clearkey",
                manifestUri: "https://abslive.akamaized.net/dash/live/2028025/jeepneytv/manifest.mpd",
                keyId: "90ea4079e02f418db7b170e8763e65f0",
                key: "1bfe2d166e31d03eee86ee568bd6c272",
                logo: "https://upload.wikimedia.org/wikipedia/en/1/15/Jeepney_TV_Logo_2015.svg",
                group:["entertainment"],
            },
            
            aniplus: {
                name: "Aniplus",
                type: "hls",
                manifestUri: "https://amg18481-amg18481c1-amgplt0352.playout.now3.amagi.tv/playlist/amg18481-amg18481c1-amgplt0352/playlist.m3u8",
                logo: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSJj494OpI0bKrTrvcHqEkzMYzqtfLNdWjQrg&s",
                group: ["cartoons & animations"],
            },
            
            sinemanila: {
                name: "SineManila",
                type: "hls",
                manifestUri: "https://live20.bozztv.com/giatv/giatv-sinemanila/sinemanila/chunks.m3u8",
                logo: "https://raw.githubusercontent.com/Shakzz890/LoidForger/main/SineManila.png",
                group:["movies", "entertainment"],
            },
        };

        // --- NEW: Force scroll top ---
        window.onbeforeunload = () => window.scrollTo(0, 0);

        // --- GLOBAL VARIABLES ---
        let shownCount = 0;
        let currentSearchFilter = "";
        let currentChannelKey = Object.keys(channels)[0];
        const tabs = ["all", "favorites", "news", "entertainment", "movies", "sports", "documentary", "cartoons & animations"];
        let currentTabIndex = 0;
        let sortedChannels = [];
        
        // TV REMOTE NAVIGATION VARIABLES
        let focusIndex = -1;
        let focusableElements = [];
        let isTvRemoteMode = false;

        // Setting a mock user ID
        const displayUserId = document.getElementById('displayUserId');
        if (displayUserId) {
            displayUserId.textContent = 'MOCK_USER_ID_123456';
        }


        // --- HELPER FUNCTIONS ---
        function resetChannelListScroll() {
            const scrollableListContainer = document.querySelector(".scrollable-list");
            if (scrollableListContainer) scrollableListContainer.scrollTop = 0;
        }

        function getOrCreateDeviceId() {
            let deviceId = localStorage.getItem('deviceId');
            if (!deviceId) {
                deviceId = window.crypto?.randomUUID?.() || 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
                    const r = Math.random() * 16 | 0;
                    return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
                });
                localStorage.setItem('deviceId', deviceId);
            }
            return deviceId;
        }

        // --- VIEWER COUNT ---
        async function updateViewerCount() {
            try {
                const deviceId = getOrCreateDeviceId();
                // This API endpoint is a mock and will likely fail, triggering the mock fallback
                const res = await fetch(`/api/viewers?deviceId=${deviceId}`);
                const data = await res.json();
                const viewerCountEl = document.getElementById('viewerCountText');
                if (viewerCountEl) viewerCountEl.innerText = data.count || 0;
            } catch (e) {
                // Mock fallback if API fails
                const viewerCountEl = document.getElementById('viewerCountText');
                if (viewerCountEl && viewerCountEl.innerText === '0') viewerCountEl.innerText = '99+'; 
            }
        }

        // --- FAVORITES STORAGE HANDLER ---
        function loadFavoritesFromStorage() {
            const stored = JSON.parse(localStorage.getItem("favoriteChannels") || "[]");
            Object.entries(channels).forEach(([key, channel]) => {
                channel.favorite = stored.includes(key);
            });
        }

        function saveFavoritesToStorage() {
            const favorites = Object.entries(channels)
                .filter(([key, ch]) => ch.favorite)
                .map(([key]) => key);
            localStorage.setItem("favoriteChannels", JSON.stringify(favorites));
        }

        // --- CLEAR ALL FAVORITES ---
        function clearAllFavorites() {
            Object.values(channels).forEach(ch => ch.favorite = false);
            localStorage.removeItem("favoriteChannels");
            renderChannelButtons(currentSearchFilter);
            console.log("All favorites cleared. â­"); 
        }

        // --- CHANNEL RENDERING ---
        function renderChannelButtons(filter = "") {
            currentSearchFilter = filter;
            const list = document.getElementById("channelList");
            if (!list) return;
            list.innerHTML = "";
            shownCount = 0;

            const selectedGroup = tabs[currentTabIndex];
            const fragment = document.createDocumentFragment();

            sortedChannels.forEach(([key, channel]) => {
                const group = channel.group || "live";
                const matchesSearch = channel.name.toLowerCase().includes(filter.toLowerCase());
                const matchesFavorites = (selectedGroup === "favorites") ? channel.favorite === true : true;
                const matchesGroup =
                    selectedGroup === "all" ||
                    selectedGroup === "favorites" ||
                    (Array.isArray(group) ? group.includes(selectedGroup) : group === selectedGroup);

                if (!matchesSearch || !matchesGroup || !matchesFavorites) return;

                const btn = document.createElement("button");
                btn.className = "channel-button focusable-element"; 
                btn.setAttribute("data-key", key);
                btn.setAttribute("tabindex", "0"); 

                const logo = document.createElement("img");
                logo.src = channel.logo;
                logo.alt = channel.name;
                logo.className = "channel-logo";

                const nameSpan = document.createElement("span");
                nameSpan.className = "channel-name";
                nameSpan.textContent = channel.name;

                // --- FAVORITE STAR ---
                const favStar = document.createElement("span");
                favStar.className = `favorite-star ${channel.favorite ? 'active' : ''}`;
                favStar.innerHTML = channel.favorite ? "â­" : "â˜†";
                favStar.onclick = (e) => {
                    e.stopPropagation();
                    channel.favorite = !channel.favorite;
                    favStar.innerHTML = channel.favorite ? "â­" : "â˜†";
                    saveFavoritesToStorage();
                    if (selectedGroup === 'favorites') {
                        renderChannelButtons(currentSearchFilter);
                        // Re-evaluate focusable elements in case clicking changed the list
                        focusableElements = getVisibleFocusableElements(); 
                    } else {
                        favStar.classList.toggle('active', channel.favorite);
                    }
                };

                btn.appendChild(logo);
                btn.appendChild(nameSpan);
                btn.appendChild(favStar);
                btn.onclick = () => loadChannel(key);

                fragment.appendChild(btn);
                shownCount++;
            });

            list.appendChild(fragment);

            const countDisplay = document.getElementById("channelCountText");
            const channelCountContainer = document.getElementById("channelCount");
            if (countDisplay && channelCountContainer) {
                countDisplay.textContent = `${shownCount} channel${shownCount !== 1 ? "s" : ""} found`;
                if (shownCount > 0) channelCountContainer.classList.add("rainbow-text");
                else channelCountContainer.classList.remove("rainbow-text");
            }

            const clearBtnEls = document.querySelectorAll('#clearFavoritesBtn'); 
            clearBtnEls.forEach(btn => {
                if (!btn) return;
                btn.style.display = (selectedGroup === "favorites" && shownCount > 0) ? "block" : "none";
            });
        }

        // --- LOAD CHANNEL ---
        function loadChannel(key) {
            const channel = channels[key];
            if (!channel) return console.error(`Channel "${key}" not found`);

            currentChannelKey = key;
            renderChannelButtons(currentSearchFilter);

            const nowPlayingEl = document.getElementById("nowPlayingChannel");
            if (nowPlayingEl) {
                nowPlayingEl.textContent = channel.name;

                const overlay = document.getElementById("nowPlayingOverlay");
                if (overlay) {
                    overlay.classList.add("now-playing-animate");
                    setTimeout(() => overlay.classList.remove("now-playing-animate"), 350);
                }
            }

            const drmConfig = {};
            let playerType = "hls";

            if (channel.type === "widevine") {
                drmConfig.widevine = { url: channel.licenseServerUri };
                playerType = "dash";
            } else if (channel.type === "clearkey") {
                if (channel.keyId && channel.key) {
                    drmConfig.clearkey = { keyId: channel.keyId, key: channel.key };
                    playerType = "dash";
                } else {
                    playerType = channel.manifestUri.endsWith('.mpd') ? 'dash' : 'hls';
                }
            } else if (channel.type === "dash") {
                playerType = "dash";
            } else if (channel.type === "hls") {
                player: 'hls';
            }

            if (typeof jwplayer !== 'function') {
                const videoContainer = document.getElementById('video');
                if (videoContainer) {
                    videoContainer.innerHTML = '<p style="color:white; text-align:center; padding-top:20px;">JW Player failed to load. Cannot play stream.</p>';
                }
                console.error("JW Player is not defined.");
                return;
            }
            
            if (jwplayer("video").getState() === 'idle') {
                 jwplayer("video").setup({
                     file: channel.manifestUri,
                     type: playerType,
                     drm: Object.keys(drmConfig).length ? drmConfig : undefined,
                     autostart: true,
                     width: "100%",
                     aspectratio: "16:9",
                     stretching: "exactfit",
                 });
            } else {
                jwplayer("video").load([
                    {
                        file: channel.manifestUri,
                        type: playerType,
                        drm: Object.keys(drmConfig).length ? drmConfig : undefined,
                    }
                ]);
                jwplayer("video").play(true);
            }

            jwplayer("video").on("error", (e) => console.error("JWPlayer Error:", (e && e.message) || e));
        }

        // --- SEARCH ---
        function setupSearch() {
            const searchInput = document.getElementById("search");
            const clearBtn = document.getElementById("clearSearch");

            if (!searchInput || !clearBtn) return;

            searchInput.value = "";
            clearBtn.style.display = "none";

            searchInput.addEventListener("input", () => {
                const val = searchInput.value.trim();
                clearBtn.style.display = val ? "block" : "none";
                renderChannelButtons(val);
                resetChannelListScroll();
                // Update focusable elements list for TV mode
                focusableElements = getVisibleFocusableElements(); 
            });

            clearBtn.addEventListener("click", () => {
                searchInput.value = "";
                clearBtn.style.display = "none";
                renderChannelButtons("");
                resetChannelListScroll();
                // Update focusable elements list for TV mode
                focusableElements = getVisibleFocusableElements(); 
            });
        }

        // --- CATEGORY TABS ---
        function setupCategoryTabs() {
            renderCategories(); 
            
            const categoryButtons = document.querySelectorAll(".category-button");
            categoryButtons.forEach((button, index) => {
                button.addEventListener("click", () => {
                    currentTabIndex = index;
                    categoryButtons.forEach(btn => btn.classList.remove("active"));
                    button.classList.add("active");
                    renderChannelButtons(currentSearchFilter);
                    resetChannelListScroll();
                    // Update focusable elements list for TV mode
                    focusableElements = getVisibleFocusableElements();
                });
            });
        }

        // --- HAMBURGER MENU ---
        function setupHamburgerMenu() {
            const hamburger = document.getElementById('hamburger');
            const mobileMenu = document.getElementById('navPages');

            if (!hamburger || !mobileMenu) return;

            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                mobileMenu.classList.toggle('active');
            });
            
            // Close menu when a link is clicked
            mobileMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    hamburger.classList.remove('active');
                    mobileMenu.classList.remove('active');
                    // Update focusable elements list for TV mode
                    focusableElements = getVisibleFocusableElements(); 
                });
            });
        }

        // --- WELCOME MODAL ---
        function setupWelcomeModal() {
            if (sessionStorage.getItem('welcomeModalShown')) return;

            const modal = document.getElementById('welcomeModal');
            const closeBtn = document.getElementById('closeModalBtn');
            const countdownSpan = document.getElementById('modalCountdown');

            if (!modal || !closeBtn || !countdownSpan) return;

            let countdown = 5;
            let countdownInterval;

            const closeModal = () => {
                modal.classList.remove('active');
                clearInterval(countdownInterval);
                sessionStorage.setItem('welcomeModalShown', 'true');
                // Re-evaluate focusable elements in case focus was inside the modal
                focusableElements = getVisibleFocusableElements(); 
            };

            const startCountdown = () => {
                countdownSpan.textContent = countdown;
                countdownInterval = setInterval(() => {
                    countdown--;
                    countdownSpan.textContent = countdown;
                    if (countdown <= 0) closeModal();
                }, 1000);
            };

            closeBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

            document.querySelectorAll("nav a, .mobile-nav-pages a").forEach(link => {
                link.addEventListener("click", () => { if (modal.classList.contains('active')) closeModal(); });
            });

            modal.classList.add('active');
            startCountdown();
        }

        // --- QR CODE MODAL ---
        function setupQrCodeModal() {
            const qrCodeImage = document.querySelector('.donation-qr-code');
            const qrModal = document.getElementById('qrModal');
            const zoomedQrImage = document.getElementById('zoomedQrImage');
            const closeQrModalBtn = document.getElementById('closeQrModalBtn');

            if (!qrCodeImage || !qrModal || !zoomedQrImage || !closeQrModalBtn) return;

            qrCodeImage.addEventListener('click', () => {
                zoomedQrImage.src = qrCodeImage.src;
                qrModal.classList.add('active');
                // Re-evaluate focusable elements
                focusableElements = getVisibleFocusableElements(); 
            });

            const closeModal = () => {
                qrModal.classList.remove('active');
                // Re-evaluate focusable elements
                focusableElements = getVisibleFocusableElements();
            };
            closeQrModalBtn.addEventListener('click', closeModal);
            qrModal.addEventListener('click', (e) => { if (e.target === qrModal) closeModal(); });
        }

        // --- BACK TO TOP BUTTON ---
        function setupBackToTopButton() {
            const backToTopButton = document.getElementById('backToTopBtn');
            const aboutSection = document.getElementById('about-us');
            if (!backToTopButton || !aboutSection) return;

            window.addEventListener('scroll', () => {
                backToTopButton.classList.toggle('show', window.scrollY > aboutSection.offsetTop);
            });

            backToTopButton.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
        
        // --- UI RENDERING FUNCTIONS ---
        function renderCategories() {
            const categories = tabs; // Use global tabs array
            const categoryBar = document.querySelector('.category-bar');
            categoryBar.innerHTML = '';
            categories.forEach((cat, index) => {
                const button = document.createElement('button');
                button.className = `category-button focusable-element ${index === currentTabIndex ? 'active' : ''}`;
                button.setAttribute('data-category', cat);
                button.setAttribute('tabindex', '0');
                button.textContent = cat.charAt(0).toUpperCase() + cat.slice(1).replace(/ & /g, ' & ');
                categoryBar.appendChild(button);
            });
        }
        
        // --- SCROLL REVEAL IMPLEMENTATION ---
        function setupScrollReveal() {
            const sections = document.querySelectorAll('.scroll-reveal');
            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.1 
            };

            const observerCallback = (entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('active');
                    } else {
                        // Keep visible elements active even if they start scrolling out of the viewport
                        // This prevents elements from disappearing while reading.
                        // We only remove 'active' if it's completely out of the viewport (optional, removed for better UX)
                        // For a staggered animation to fire correctly, we usually only observe for 'intersecting'.
                    }
                });
            };

            const observer = new IntersectionObserver(observerCallback, observerOptions);

            sections.forEach(section => {
                observer.observe(section);

                // FIX: Manual check on load for elements that should already be visible
                const rect = section.getBoundingClientRect();
                const viewportHeight = window.innerHeight || document.documentElement.clientHeight;

                // If the element's top is visible or just slightly above the viewport (0 to 100px above for buffer)
                if (rect.top <= viewportHeight && rect.bottom >= 0) {
                     // Adding a slight delay (0ms) forces the browser to apply initial CSS before activation.
                    setTimeout(() => section.classList.add('active'), 0);
                }
            });
        }

        // --- TV REMOTE NAVIGATION CORE LOGIC (New Feature Implementation) ---
        function getVisibleFocusableElements() {
            // Collect all elements intended for navigation
            const selectors = '.focusable-element:not([style*="display: none"]):not([aria-hidden="true"]):not([disabled])';
            const elements = Array.from(document.querySelectorAll(selectors));

            // Filter for visibility and exclude elements in closed menus/modals
            return elements.filter(el => {
                // Check if element or its ancestor is in a hidden modal/menu, but allow if modal is active
                const isHiddenParent = el.closest('.modal-overlay:not(.active), .mobile-nav-pages:not(.active), #clearFavoritesBtn:not([style*="block"])');
                
                // Exclude elements that are visually hidden 
                const style = window.getComputedStyle(el);
                const isVisible = style.display !== 'none' && style.visibility !== 'hidden' && style.opacity !== '0';

                return !isHiddenParent && isVisible;
            });
        }

        function updateFocus(newIndex) {
            if (focusIndex > -1 && focusableElements[focusIndex]) {
                focusableElements[focusIndex].classList.remove('focused', 'scale');
            }

            if (newIndex >= 0 && newIndex < focusableElements.length) {
                focusIndex = newIndex;
                const newFocus = focusableElements[focusIndex];
                newFocus.classList.add('focused', 'scale');
                newFocus.focus({ preventScroll: true }); 
                
                // Scroll the parent container to bring the focused element into view
                const parentScroll = newFocus.closest('.scrollable-list');
                if (parentScroll) {
                    const rect = newFocus.getBoundingClientRect();
                    const parentRect = parentScroll.getBoundingClientRect();

                    if (rect.top < parentRect.top) {
                        parentScroll.scrollTop -= (parentRect.top - rect.top) + 10;
                    } else if (rect.bottom > parentRect.bottom) {
                        parentScroll.scrollTop += (rect.bottom - parentRect.bottom) + 10;
                    }
                }
            } else {
                focusIndex = -1;
            }
        }

        function handleTvRemoteNavigation(event) {
            const key = event.key;
            
            // Check current modal/menu state
            const isMobileMenuOpen = document.getElementById('navPages').classList.contains('active');
            const isWelcomeModalOpen = document.getElementById('welcomeModal').classList.contains('active');
            const isQrModalOpen = document.getElementById('qrModal').classList.contains('active');
            const isModalOpen = isWelcomeModalOpen || isQrModalOpen;

            // Only engage TV remote mode for specific keys
            if (!['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Enter', 'Escape', 'Back'].includes(key)) return;
            
            isTvRemoteMode = true;
            event.preventDefault(); 
            
            // Re-fetch elements if the list might have changed (e.g., filter applied, modal opened/closed)
            focusableElements = getVisibleFocusableElements();

            if (focusableElements.length === 0) {
                focusIndex = -1;
                return;
            }

            // --- Handle Escape/Back Key (Close Modals/Menus) ---
            if (key === 'Escape' || key === 'Back') {
                if (isWelcomeModalOpen) {
                    document.getElementById('closeModalBtn').click();
                } else if (isQrModalOpen) {
                    document.getElementById('closeQrModalBtn').click();
                } else if (isMobileMenuOpen) {
                    document.getElementById('hamburger').click();
                }
                return;
            }
            
            // --- Handle Enter Key (Simulate Click) ---
            if (key === 'Enter') {
                if (focusIndex > -1) {
                    // Remove focus glow immediately before click action
                    focusableElements[focusIndex].classList.remove('focused', 'scale'); 
                    // Use a slight delay for re-evaluating focusable elements after the click action
                    setTimeout(() => {
                        focusableElements[focusIndex].click(); 
                        focusableElements = getVisibleFocusableElements();
                        if (focusIndex >= focusableElements.length) focusIndex = -1;
                        if (focusIndex > -1) updateFocus(focusIndex);
                    }, 50);
                } else {
                    // If nothing focused, try to click the first focusable element
                    if (focusableElements[0]) focusableElements[0].click();
                }
                return;
            }
            
            // --- Determine initial focus point if none is set ---
            if (focusIndex === -1 || !focusableElements[focusIndex]) {
                const firstChannelBtn = focusableElements.findIndex(el => el.classList.contains('channel-button'));
                focusIndex = firstChannelBtn !== -1 ? firstChannelBtn : 0;
            }
            
            let newIndex = focusIndex;

            // --- Handle Arrow Keys (Next/Previous Focus) ---
            switch (key) {
                case 'ArrowDown':
                    newIndex = (focusIndex + 1) % focusableElements.length;
                    break;
                case 'ArrowUp':
                    newIndex = (focusIndex - 1 + focusableElements.length) % focusableElements.length;
                    break;
                case 'ArrowRight':
                case 'ArrowLeft':
                    // Basic lateral movement logic: prioritize channel buttons/category buttons
                    const currentEl = focusableElements[focusIndex];
                    const isCategoryBtn = currentEl.classList.contains('category-button');
                    const isChannelBtn = currentEl.classList.contains('channel-button');

                    if (isCategoryBtn) {
                        const allCategoryButtons = Array.from(document.querySelectorAll('.category-button')).filter(el => window.getComputedStyle(el).display !== 'none');
                        const catIndex = allCategoryButtons.indexOf(currentEl);
                        
                        if (key === 'ArrowRight' && catIndex < allCategoryButtons.length - 1) {
                            newIndex = focusableElements.indexOf(allCategoryButtons[catIndex + 1]);
                        } else if (key === 'ArrowLeft' && catIndex > 0) {
                            newIndex = focusableElements.indexOf(allCategoryButtons[catIndex - 1]);
                        } else {
                            newIndex = (key === 'ArrowRight') ? (focusIndex + 1) % focusableElements.length : (focusIndex - 1 + focusableElements.length) % focusableElements.length;
                        }
                    } else if (isChannelBtn) {
                        // Channel buttons are 1 per row, so treat left/right as up/down
                        newIndex = (key === 'ArrowRight') ? (focusIndex + 1) % focusableElements.length : (focusIndex - 1 + focusableElements.length) % focusableElements.length;
                    } else {
                         // Default to standard linear navigation
                        newIndex = (key === 'ArrowRight') ? (focusIndex + 1) % focusableElements.length : (focusIndex - 1 + focusableElements.length) % focusableElements.length;
                    }
                    break;
            }
            
            updateFocus(newIndex);
        }

        // Add event listener for TV remote key handling
        document.addEventListener('keydown', handleTvRemoteNavigation);

        // Clear the focus when the user uses a mouse/touch
        document.addEventListener('mousedown', (e) => {
            isTvRemoteMode = false;
            if (focusIndex > -1 && focusableElements[focusIndex]) {
                focusableElements[focusIndex].classList.remove('focused', 'scale');
                focusIndex = -1;
            }
        });
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            // Set up channels and sorting
            sortedChannels = Object.entries(channels).sort((a, b) => a[1].name.localeCompare(b[1].name));

            // Load state
            loadFavoritesFromStorage();

            // Setup UI interactions
            setupSearch();
            setupCategoryTabs();
            setupWelcomeModal();
            setupHamburgerMenu();
            setupBackToTopButton();
            setupQrCodeModal();
            setupScrollReveal(); // Initialize the scroll animations

            // Render initial channel list
            renderChannelButtons();
            resetChannelListScroll();

            // Attach click handler to clearFavoritesBtn
            const clearFavBtn = document.getElementById("clearFavoritesBtn");
            if (clearFavBtn) {
                clearFavBtn.addEventListener('click', clearAllFavorites);
            }

            // Set initial channel and start viewer count updates
            const initialChannelKey = sortedChannels[0]?.[0] || Object.keys(channels)[0];
            if (channels[initialChannelKey]) loadChannel(initialChannelKey);

            updateViewerCount();
            setInterval(updateViewerCount, 5000);
            
            // Initial calculation of focusable elements for TV Remote mode
            focusableElements = getVisibleFocusableElements(); 
        });
        
        // --- NOTIFICATION BANNER LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            const banner = document.getElementById('liveNotificationBanner');
            const messageEl = document.getElementById('notificationMessage');
            const closeBtn = document.getElementById('closeNotificationBtn');
            const NOTIFICATION_URL = 'notification.json';
            const SESSION_KEY = 'notificationClosed';
            let currentNotificationId = null;

            if (!banner || !messageEl || !closeBtn) {
                return;
            }

            // --- Show/Hide Logic ---
            function showBanner(message, type = 'alert', autoHide = true) {
                messageEl.innerHTML = message;
                banner.classList.remove('info', 'success', 'alert', 'hide');
                banner.classList.add(type || 'alert');

                banner.style.display = 'flex';
                setTimeout(() => banner.classList.add('show'), 10);

                if (autoHide) {
                    setTimeout(() => hideBanner(), 8000);
                }
            }

            function hideBanner() {
                banner.classList.remove('show');
                banner.classList.add('hide');
                setTimeout(() => (banner.style.display = 'none'), 400);
            }

            // --- Close Button ---
            closeBtn.addEventListener('click', () => {
                hideBanner();
                sessionStorage.setItem(SESSION_KEY, currentNotificationId || 'true');
            });

            // --- Fetch Notification ---
            async function fetchNotification() {
                try {
                    // NOTE: This fetch call will fail in the current sandboxed environment
                    // It will fall back to the hardcoded message defined in the HTML.
                    const response = await fetch(`${NOTIFICATION_URL}?t=${Date.now()}`);
                    if (!response.ok) throw new Error('Notification file not found.');

                    const data = await response.json();
                    const lastClosed = sessionStorage.getItem(SESSION_KEY);
                    const shouldShow = data.show && (lastClosed !== data.id);

                    currentNotificationId = data.id;

                    if (shouldShow) showBanner(data.message, data.type);
                    else hideBanner();
                } catch (error) {
                    // Default to showing the hardcoded message if fetch fails
                    showBanner(messageEl.textContent, 'info', true);
                }
            }

            // --- Run on Load + Every 60s ---
            fetchNotification();
            setInterval(fetchNotification, 60000);
        });
    </script>
</body>
</html>
