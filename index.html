<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="Jinwoo.png">
    <title>Shakzz TV</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- JW Player Script -->
    <script src="https://ssl.p.jwpcdn.com/player/v/8.36.6/jwplayer.js"></script>
    <script>jwplayer.key = "ITWMv7t88JGzI0xPwW8I0+LveiXX9SWbfdmt0ArUSyc="</script>
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- Google Fonts: Outfit for a modern tech feel -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #050505;
            --text-color: #e0e0e0;
            --text-muted: #9ca3af;
            /* Modern Electric Blue/Purple Gradient */
            --accent-gradient: linear-gradient(135deg, #3b82f6, #8b5cf6);
            --accent-color: #6366f1;
            --glass-bg: rgba(30, 30, 30, 0.4);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-blur: blur(20px);
            --header-height: 70px;
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 12px;
        }

        /* Basic Reset */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            /* Fix 1: Ensure scrollable area background is dark */
            background-color: var(--bg-color);
        }

        /* --- Custom Scrollbar Styling --- */
        /* Target the main scrollable element: .scrollable-list */
        .scrollable-list::-webkit-scrollbar {
            width: 8px;
        }
        .scrollable-list::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }
        .scrollable-list::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 10px;
            border: 2px solid rgba(0, 0, 0, 0);
            background-clip: padding-box;
        }
        .scrollable-list::-webkit-scrollbar-thumb:hover {
            background: #8b5cf6; /* A slightly lighter purple/blue on hover */
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        body {
            /* Deep dark animated background */
            background: radial-gradient(circle at top left, #1a1c2e, #000000),
                        radial-gradient(circle at bottom right, #0f172a, #000000);
            background-attachment: fixed;
            color: var(--text-color);
            font-family: 'Outfit', sans-serif;
            line-height: 1.7;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
            background-size: 400% 400%; /* For potential background animation */
        }
        
        /* Fix 1: Ensure background dark color during mobile overscroll/bounce */
        body {
            -webkit-overflow-scrolling: touch;
            background-color: var(--bg-color);
        }

        /* Fix for mobile menu scroll locking */
        body.mobile-menu-active {
            overflow: hidden;
        }

        ul {
            list-style: none;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        /* Container & Headings */
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 0 20px;
        }

        .lg-heading {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 700;
            letter-spacing: -1px;
            background: linear-gradient(to right, #fff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* --- MODERN FLOATING HEADER --- */
        .page-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            /* Glassmorphism Header */
            background-color: rgba(0, 0, 0, 0.9); 
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border-bottom: 1px solid var(--glass-border);
            opacity: 0;
            animation: fadeDownEntry 1.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        
        @keyframes fadeDownEntry {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .top-nav {
            width: 100%;
            max-width: 100%; 
            margin: 0 auto;
            padding: 0 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: var(--header-height);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .nav-logo:hover {
            transform: scale(1.05);
        }

        .nav-logo img {
            height: 40px;
            width: auto;
            filter: drop-shadow(0 0 8px rgba(56, 189, 248, 0.3));
        }

        .logo-text {
            font-size: 1.5em;
            /* Modern Gradient Text */
            background: linear-gradient(120deg, #38bdf8, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .nav-pages {
            position: relative; 
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.05);
            padding: 5px;
            border-radius: 50px;
            border: 1px solid var(--glass-border);
        }

        /* New styles for sliding highlight */
        .nav-highlight {
            position: absolute;
            top: 5px;
            left: 5px;
            height: calc(100% - 10px);
            /* UPDATED: Royal Blue Background + Glow */
            background: #4169e1; 
            box-shadow: 0 0 12px rgba(65, 105, 225, 0.6);
            border-radius: 40px;
            transition: all 0.35s cubic-bezier(0.25, 0.8, 0.25, 1);
            width: 0;
            opacity: 0; 
            z-index: 1;
            pointer-events: none;
        }

        .nav-pages a {
            position: relative;
            z-index: 2; 
            font-weight: 500;
            font-size: 0.9rem;
            text-transform: uppercase;
            color: var(--text-muted);
            padding: 8px 18px;
            border-radius: 40px;
            transition: all 0.3s ease;
        }

        .nav-pages a:hover {
            color: #fff;
            background: transparent; 
        }

        .nav-pages a.active-link {
            color: #fff;
        }
        
        /* Focus/Selection Glow for Smart TVs */
        .focusable-element:focus:not(:focus-visible),
        .focusable-element.tv-focus {
            outline: 3px solid #38bdf8 !important;
            outline-offset: 1px;
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.5) !important;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        #viewerCounter {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #a5b4fc;
            background: rgba(99, 102, 241, 0.1);
            padding: 6px 14px;
            border-radius: 50px;
            border: 1px solid rgba(99, 102, 241, 0.2);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .click-here-link {
            font-weight: 700;
            color: #fff;
            background: var(--accent-gradient);
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }
        
        .click-here-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.5);
        }

        /* Hamburger Menu */
        .hamburger {
            display: none;
            flex-direction: column;
            justify-content: space-around;
            width: 28px;
            height: 22px;
            cursor: pointer;
            z-index: 1001; 
        }

        .hamburger span {
            display: block;
            height: 2.5px;
            width: 100%;
            background: #fff;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 6px);
        }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -6px);
        }

        /* Mobile Menu (Fullscreen Overlay) */
        .mobile-nav-pages {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 30px;
            
            /* Fullscreen fixed position */
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            
            /* Black background with 50% opacity + blur */
            background-color: rgba(0, 0, 0, 0.5); 
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: all 0.4s ease;
            z-index: 1000;
            
            right: auto;
            border: none;
            border-radius: 0;
            box-shadow: none;
            transform: none;
            padding: 0;
        }

        .mobile-nav-pages.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }
        
        .mobile-nav-pages a {
            font-size: 1.8rem; 
            font-weight: 700;
            text-transform: uppercase;
            color: #fff;
            padding: 10px 20px;
            border-radius: 8px;
            transition: 0.3s;
            text-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        
        .mobile-nav-pages a:hover {
            color: var(--accent-color);
            transform: scale(1.1);
            background: transparent;
        }

        /* --- MAIN LAYOUT (MAXIMIZED) --- */
        #main-content-area {
            display: flex;
            /* REMOVED GAP AND PADDING TO MAXIMIZE SPACE */
            gap: 0; 
            padding: 0;
            flex-grow: 1;
            height: calc(100vh - var(--header-height)); 
            margin-top: var(--header-height);
            overflow: hidden;
            opacity: 0;
            animation: fadeUpEntry 1.8s cubic-bezier(0.16, 1, 0.3, 1) 0.3s forwards;
        }
        
        @keyframes fadeUpEntry {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .main-player-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            background: #000;
            /* REMOVED RADIUS FOR MAXIMIZED LOOK */
            border-radius: 0; 
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            border: none; 
            position: relative;
        }

        #playerWrapper {
            position: relative;
            flex: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
        }

        #video {
            flex: 1;
            width: 100%;
            min-height: 0;
            background: black;
        }

        /* SIDEBAR (Maximized) */
        .sidebar {
            width: 380px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            min-height: 0;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            /* REMOVED RADIUS */
            border-radius: 0;
            /* Keep left border for separation */
            border-left: 1px solid var(--glass-border);
            border-top: none;
            border-right: none;
            border-bottom: none;
            overflow-y: hidden; /* Internal scrolling */
            margin-left: 0;
        }

        /* Search in Sidebar */
        .search-container {
            position: relative;
            display: flex;
            align-items: center;
            margin: 20px;
        }

        .search-container input {
            flex: 1;
            padding: 12px 40px 12px 16px;
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            background-color: rgba(0,0,0,0.3);
            color: white;
            width: 100%;
            font-size: 0.95rem;
            font-family: 'Outfit', sans-serif;
            transition: all 0.3s ease;
        }
        
        .search-container input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
            background-color: rgba(0,0,0,0.5);
        }

        #clearSearch {
            position: absolute;
            right: 12px;
            cursor: pointer;
            color: #666;
            transition: 0.2s;
        }
        #clearSearch:hover { color: #fff; }

        /* Category Bar (Modern Pills) */
        .category-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 0 20px 15px;
            border-bottom: 1px solid var(--glass-border);
        }

        .category-button {
            background: rgba(255,255,255,0.05);
            color: #ccc;
            border: 1px solid transparent;
            border-radius: 50px;
            padding: 6px 14px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            flex: 1 0 auto; /* auto grow */
        }

        .category-button:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            transform: translateY(-1px);
        }

        .category-button.active {
            background: var(--accent-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }
        
        /* Mobile Category Button (Now functional, linked to modal) */
        .mobile-category-btn {
            display: none;
            width: calc(100% - 40px);
            padding: 14px 20px;
            margin: 0 20px 15px;
            background: rgba(255,255,255,0.05);
            color: white;
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            font-size: 0.95rem;
            cursor: pointer;
            text-align: left;
            justify-content: space-between;
            align-items: center;
            font-family: 'Outfit', sans-serif;
            transition: all 0.3s ease;
        }
        
        .mobile-category-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        /* Channel List Area */
        #channelCount {
            padding: 10px 20px;
            font-weight: 600;
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .scrollable-list {
            flex: 1;
            overflow-y: auto;
            background-color: transparent;
            padding: 0 15px 15px;
        }
        
        .channel-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .channel-button {
            width: 100%;
            padding: 12px;
            background-color: rgba(255,255,255,0.03);
            border: 1px solid transparent;
            border-radius: 12px;
            color: #eee;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            font-size: 0.95rem;
        }

        .channel-button:hover {
            background-color: rgba(255,255,255,0.08);
            transform: translateX(4px);
            border-color: rgba(255,255,255,0.1);
        }
        
        .channel-button:active {
            transform: scale(0.98);
        }

        .channel-logo {
            width: 36px;
            height: 36px;
            object-fit: contain;
            border-radius: 8px;
            background-color: #fff;
            flex-shrink: 0;
            padding: 2px;
        }
        
        .channel-name {
            flex-grow: 1;
            white-space: normal;
            text-align: left;
            line-height: 1.4;
            font-weight: 500;
        }

        /* --- CARD SECTIONS (About, Updates, Contact) --- */
        .info-section {
            /* Adjusted margin to fix white artifact between sections and general spacing */
            margin: 4rem auto; 
            padding: 4rem;
            max-width: 1100px;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            /* Updated scroll-margin-top to use the header height variable for better dynamic positioning */
            scroll-margin-top: var(--header-height); 
            position: relative;
            overflow: hidden;
        }

        /* Fix the specific issue: Remove top margin from the first section when it hits the top */
        #about-us {
            margin-top: 1rem; /* Reduced margin for top spacing after player */
        }
        
        /* Fix: Ensure the element scrolls up right beneath the fixed header */
        /* Use a dedicated class for scroll targets to ensure they always land correctly */
        .nav-scroll-target {
            scroll-margin-top: calc(var(--header-height) + 20px);
        }

        /* Ensure smooth flow for the last two dark sections */
        #contact.info-section {
            margin-bottom: 0; 
            padding-bottom: 4rem;
            background: linear-gradient(180deg, rgba(30,30,30,0.6) 0%, rgba(10,10,10,0.9) 100%);
            border-radius: 30px 30px 0 0; 
            border-bottom: none;
        }
        
        /* Glowing effect behind cards (Pseudo-element) */
        .info-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .info-section h2 {
            margin-bottom: 2.5rem;
            font-weight: 800;
        }

        .info-section h3 {
            font-size: 1.5rem;
            margin: 2.5rem 0 1rem;
            color: #fff;
            font-weight: 600;
        }

        .info-section p {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            color: #cbd5e1; /* lighter grey */
            line-height: 1.8;
            font-weight: 300;
        }

        .contact-container {
            display: flex;
            flex-wrap: wrap;
            gap: 4rem;
            justify-content: center;
            align-items: flex-start;
        }

        /* Contact Social Side */
        .contact-social {
            flex: 1;
            min-width: 300px;
            text-align: center;
        }
        
        .contact-social h2.lg-heading {
            font-size: 3.2rem;
            margin-bottom: 1;
        }

        .contact-social p {
            font-size: 1.1rem;
            margin-bottom: 0.2rem; /* Reduced margin for tighter spacing */
        }

        .contact-social .contact-links {
            display: flex;
            gap: 20px;
            justify-content: center;
            padding: 5px 0; 
        }
        
        .social-link {
            transition: transform 0.3s ease;
        }

        /* Contact Form Styling - Card Removed on All Screens */
        .contact-form {
            flex: 1.2;
            min-width: 320px;
            background: transparent; 
            padding: 0;
            border-radius: 0;
            border: none;
        }

        .contact-form label {
            display: block;
            margin-top: 1.5rem;
            font-size: 0.9rem;
            text-align: left;
            color: var(--text-muted);
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .contact-form input,
        .contact-form textarea {
            width: 100%;
            padding: 16px;
            margin-top: 10px;
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            background-color: rgba(0,0,0,0.2);
            color: #fff;
            font-size: 1rem;
            font-family: 'Outfit', sans-serif;
            transition: all 0.3s ease;
        }
        
        .contact-form input:focus,
        .contact-form textarea:focus {
            border-color: var(--accent-color);
            background-color: rgba(0,0,0,0.4);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
        }

        .contact-form button {
            padding: 16px;
            border: none;
            border-radius: 12px;
            background: var(--accent-gradient);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 30px;
            width: 100%;
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }

        .contact-form button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.5);
        }

        /* Footer */
        .copyright-text {
            text-align: center;
            margin-top: 1.5rem;
            color: #555;
            font-size: 0.85rem;
        }

        /* --- MODAL (Modern Glass) --- */
        .modal-overlay {
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            inset: 0;
            background: rgba(5, 5, 10, 0.7);
            backdrop-filter: blur(10px);
            z-index: 2000;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            /* FIX 2: Ensure the overlay is full height to center content correctly */
            height: 100%; 
        }

        .modal-overlay.active {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background: rgba(20, 20, 25, 0.9);
            color: #fff;
            padding: 40px;
            border-radius: 24px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 1px solid var(--glass-border);
            animation: modalPop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            
            /* REMOVED: margin: auto; Rely on parent flexbox for centering */
        }
        
        @keyframes modalPop {
            from { opacity: 0; transform: scale(0.9) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 20px;
            cursor: pointer;
            color: #fff;
            transition: 0.2s;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }
        .close-button:hover { background: #ef4444; transform: rotate(90deg); }

        .modal-heading {
            margin-top: 10px;
            margin-bottom: 15px;
            font-size: 1.8rem;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Mobile Category Modal Specific */
        .mobile-category-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 50vh;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .mobile-cat-option {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 12px;
            text-align: left;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }
        .mobile-cat-option:hover, .mobile-cat-option.active {
            background: var(--accent-gradient);
            color: white;
        }

        /* Back-to-Top Modern */
        #backToTopBtn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1500;
            width: 56px;
            height: 56px;
            border: none;
            border-radius: 20px;
            background: var(--accent-gradient);
            color: #fff;
            cursor: pointer;
            font-size: 20px;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
            transform: translateY(20px);
        }

        #backToTopBtn.show {
            display: flex;
            opacity: 1;
            transform: translateY(0);
        }

        #backToTopBtn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.6);
        }

        /* --- ANIMATIONS --- */
        
        /* Initial state is non-animated (visible) */
        .scroll-reveal {
            /* ADJUSTED DURATION TO 2.5s */
            opacity: 1;
            transition: opacity 2.5s cubic-bezier(0.16, 1, 0.3, 1), 
                        transform 2.5s cubic-bezier(0.16, 1, 0.3, 1);
            will-change: opacity, transform;
        }

        /* Hidden Initial States */
        .scroll-reveal.reveal-init { opacity: 0; }
        .scroll-reveal.reveal-init.pop-up { transform: scale(0.8) translateY(30px); }
        .scroll-reveal.reveal-init.slide-left { transform: translateX(-60px); }
        .scroll-reveal.reveal-init.slide-right { transform: translateX(60px); }

        /* Active State */
        .scroll-reveal.active {
            opacity: 1;
            transform: scale(1) translateX(0) translateY(0);
        }

        /* Updates List Alternating Logic */
        .updates-scroll-container { margin-top: 3rem; }
        .updates-scroll-container .update-item {
            background: rgba(255,255,255,0.02);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            /* ADJUSTED DURATION TO 2.5s */
            transition: opacity 2.5s cubic-bezier(0.16, 1, 0.3, 1), transform 2.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        .updates-scroll-container .update-item h3 {
            color: #fff;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        .updates-scroll-container .update-item.reveal-init { opacity: 0; }
        /* Left / Right Alternating */
        .updates-scroll-container .update-item.reveal-init:nth-child(odd) { transform: translateX(-80px); }
        .updates-scroll-container .update-item.reveal-init:nth-child(even) { transform: translateX(80px); }
        
        .updates-scroll-container .update-item.active {
            opacity: 1;
            transform: translateX(0);
        }

        /* --- Responsive --- */
        @media (max-width: 992px) {
            #main-content-area {
                flex-direction: column;
                height: auto;
                padding: 10px;
                gap: 20px;
            }
            #video {
                height: auto;
                aspect-ratio: 16/9;
            }
            .sidebar {
                width: 100%;
                height: auto;
                border-left: none;
                border-top: 1px solid var(--glass-border);
                margin-top: 0;
            }
            /* Show Mobile Category Button, Hide Desktop Bar */
            .category-bar { display: none; }
            .mobile-category-btn { display: flex; } 

            .scrollable-list { max-height: 500px; }
            .nav-pages { display: none; }
            .hamburger { display: flex; }
            .click-here-link { display: none; }
            .info-section {
                margin: 2rem 10px;
                padding: 2rem;
            }
            .contact-container { flex-direction: column; gap: 3rem; }
            .contact-social, .contact-form { width: 100%; min-width: 0; }
            
            /* Mobile Contact Form styling adjustments (Re-adds card on mobile only) */
            .contact-form {
                padding: 2rem;
                border: 1px solid var(--glass-border);
                border-radius: var(--radius-lg);
                background: rgba(255,255,255,0.02);
            }
            #contact.info-section {
                /* Reset for mobile view where sections are stacked */
                border-radius: 30px; 
            }
        }
        
        /* JS Driven Classes */
        .now-playing-animate {
            animation: pulseHighlight 0.35s ease-in-out;
        }
        @keyframes pulseHighlight {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); color: var(--accent-color); }
            100% { transform: scale(1); }
        }
        
        /* Notification Banner */
        .notification-banner {
            position: fixed;
            top: 85px;
            left: 50%;
            transform: translateX(-50%) translateY(-40px);
            width: 90%;
            max-width: 500px;
            padding: 16px 24px;
            border-radius: 16px;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(56, 189, 248, 0.2);
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
            color: white;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .notification-banner.show { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }
        .notification-banner.info { border-left: 4px solid #38bdf8; }
        
        /* Utility */
        .neon-bubble {
            font-size: 2.2rem;
            color: #fff;
            filter: drop-shadow(0 0 8px rgba(56, 189, 248, 0.5));
            transition: 0.3s;
        }
        .neon-bubble:hover { color: #38bdf8; transform: scale(1.2); }
        
        .donation-qr-code {
            width: 180px;
            border-radius: 12px;
            margin-top: 10px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .donation-qr-code:hover { transform: scale(1.05); }
    </style>
</head>
<body>
    <header class="page-header">
        <nav class="top-nav">
            <div class="nav-left">
                <div class="nav-logo" onclick="location.reload()">
                    <img src="Jinwoo.png" alt="Logo" onerror="this.style.display='none'">
                    <span class="logo-text">Shakzz TV</span>
                </div>
                <div class="nav-pages">
                    <!-- Sliding highlight pill -->
                    <div class="nav-highlight"></div>
                    <!-- Added Home button. It scrolls to the top of the body/main content area. -->
                    <a href="#main-content-area" class="focusable-element" onclick="window.scrollTo({ top: 0, behavior: 'smooth' }); return false;">Home</a>
                    <a href="#about-us" class="focusable-element">About</a>
                    <a href="#updates" class="focusable-element">Updates</a>
                    <a href="#privacy-policy" class="focusable-element">Privacy</a>
                    <a href="#contact" class="focusable-element">Contact</a>
                </div>
            </div>
            <div class="nav-links">
                <div id="viewerCounter">
                    <i class="fas fa-eye"></i>
                    <span id="viewerCountText">0</span>
                </div>
                <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target="_blank" class="click-here-link focusable-element">CLICK HERE</a>
                <div class="hamburger focusable-element" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </nav>
        <div class="mobile-nav-pages" id="navPages">
            <a href="#main-content-area" class="focusable-element" onclick="window.scrollTo({ top: 0, behavior: 'smooth' }); return false;">Home</a>
            <a href="#about-us" class="focusable-element">About</a>
            <a href="#updates" class="focusable-element">Updates</a>
            <a href="#privacy-policy" class="focusable-element">Privacy</a>
            <a href="#contact" class="focusable-element">Contact</a>
            <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target="_blank" class="click-here-link focusable-element">CLICK HERE</a>
        </div>
    </header>

    <!-- ðŸ”” Live Notification Banner -->
    <div id="liveNotificationBanner" class="notification-banner info hide">
        <div class="notification-content" style="display:flex; align-items:center; gap:10px; flex:1;">
            <i class="fas fa-broadcast-tower" style="color:#38bdf8;"></i>
            <span id="notificationMessage" style="font-weight:500; font-size:0.9rem;">ðŸŽ¥ LIVE: New channels added to 'Movies'!</span>
        </div>
        <button id="closeNotificationBtn" class="close-notification-btn focusable-element" style="background:none; border:none; color:#94a3b8; font-size:1.2rem; cursor:pointer;">&times;</button>
    </div>

    <section id="main-content-area">
        <div class="main-player-section">
            <div id="playerWrapper" style="position: relative;">
                <div id="video"></div>
                <div id="overlayContainer" style="
                    position: absolute;
                    top: 15px;
                    left: 20px;
                    z-index: 10;">
                    <div id="nowPlayingOverlay" style="
                        background: rgba(0,0,0,0.6);
                        backdrop-filter: blur(4px);
                        padding: 6px 14px;
                        border-radius: 20px;
                        font-weight: 600;
                        font-size: 0.8rem;
                        color: #fff;
                        border: 1px solid rgba(255,255,255,0.1);
                        display: flex; align-items: center; gap: 6px;">
                        <span style="width:8px; height:8px; background:#ef4444; border-radius:50%; display:inline-block;"></span>
                        Now Playing: <span id="nowPlayingChannel">--</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="search-container">
                <input type="text" id="search" placeholder="Search channel..." class="focusable-element" tabindex="0">
                <span id="clearSearch" class="clear-btn" style="top: 50%; transform: translateY(-50%); right: 15px;">Ã—</span>
            </div>

            <!-- Desktop Category Grid -->
            <div class="category-bar">
                <!-- Buttons will be rendered here by JS -->
            </div>
            
            <!-- Mobile Category Button -->
            <button id="mobileCategoryBtn" class="mobile-category-btn focusable-element">
                <span>All Categories</span>
                <i class="fas fa-chevron-down"></i>
            </button>

            <!-- Category Modal -->
            <div id="categoryModal" class="modal-overlay">
                <div class="modal-content category-modal-content" style="padding: 25px; width: 85%;">
                    <span class="close-button focusable-element" id="closeCategoryModal" tabindex="0" style="top:15px; right:15px;">Ã—</span>
                    <h3 class="modal-heading" style="margin-top:0;">Select Category</h3>
                    <div id="mobileCategoryList" class="mobile-category-list">
                        <!-- Buttons injected here -->
                    </div>
                </div>
            </div>

            <button id="clearFavoritesBtn" class="clear-fav-btn focusable-element" style="display:none;">
                <i class="fas fa-trash"></i> Clear Favorites
            </button>

            <div id="channelCount">
                <i class="fas fa-tv"></i>
                <span id="channelCountText">0 channels found</span>
            </div>

            <div class="scrollable-list">
                <div class="channel-list" id="channelList">
                    <!-- Channels will be rendered here -->
                </div>
            </div>
        </div>
    </section>

    <!-- ABOUT US SECTION (Alternating Animation) -->
    <section id="about-us" class="info-section scroll-reveal reveal-init nav-scroll-target">
        <div class="container">
            <!-- Heading: POP UP -->
            <h2 class="lg-heading scroll-reveal reveal-init pop-up">About Shakzz TV</h2>
            
            <!-- Content: Zig-Zag (Left, Right, Left) -->
            <p class="scroll-reveal reveal-init slide-left">Shakzz TV delivers a premier, curated portfolio of local and international networks, providing a seamless, high-quality streaming experience available 24/7. Our platform offers a comprehensive spectrum of programming designed to cater to every interestâ€”from breaking news and live sports to insightful documentaries and engaging animation.</p>
            
            <h3 class="scroll-reveal reveal-init slide-right">Our Vision & Commitment</h3>
            <p class="scroll-reveal reveal-init slide-left">To become the go-to free streaming service for Filipinos everywhere, bridging distances by providing a reliable and comprehensive source of local and international content. We envision a platform where every user feels connected to home, informed about the world, and entertained without barriers. We are committed to delivering a stable and high-quality streaming experience. This means continuously optimizing our platform for minimal buffering, expanding our channel lineup based on viewer feedback, and ensuring our service remains accessible and easy to use for everyone, on any device.</p>
            
            <h3 class="scroll-reveal reveal-init slide-right">The 'Why': A Note from the Creator</h3>
            <p class="scroll-reveal reveal-init slide-left">Shakzz TV was born from a simple idea: everyone deserves easy access to the channels they love, especially those that connect them to news, culture, and entertainment from home. As a passionate developer and media enthusiast, I created this platform to solve the common frustration of unreliable streams and scattered content. This project is a labor of love, dedicated to providing a seamless and free service for the community.</p>
        </div>
    </section>

    <!-- UPDATES SECTION (Alternating Animation) -->
    <section id="updates" class="info-section scroll-reveal reveal-init nav-scroll-target">
        <div class="container">
            <!-- Heading: POP UP -->
            <h2 class="lg-heading scroll-reveal reveal-init pop-up">Latest Updates</h2>
            
            <!-- List Items: Automatically alternates Left/Right via CSS nth-child -->
            <div class="updates-scroll-container">
                <div class="update-item scroll-reveal reveal-init">
                    <h3>Live Notification <span class="update-date" style="font-size:0.8em; opacity:0.7;">[2025-11-08]</span></h3>
                    <p>Weâ€™ve introduced a new <strong>Live Notification System</strong> that allows instant announcements right inside the app! Notifications can now appear on-screen for important updates like new channels, live events, or maintenance alerts â€” without needing to refresh the page.</p>
                </div>

                <div class="update-item scroll-reveal reveal-init">
                    <h3>TV Remote Compatibility <span class="update-date" style="font-size:0.8em; opacity:0.7;">[2025-11-08]</span></h3>
                    <p>Shakzz TV web app is now fully <strong>Smart TV compatible!</strong> You can navigate the entire interface using your remoteâ€™s arrow keys, press <strong>Enter</strong> to play channels instantly, and use <strong>Back</strong> or <strong>Esc</strong> to close menus or modals.</p>
                    <p>Supported platforms include <strong>Android TV, Fire TV, Tizen,</strong> and <strong>WebOS</strong>. Plus, youâ€™ll enjoy smoother transitions and a new soft blue focus glow for clearer navigation.</p>
                </div>

                <div class="update-item scroll-reveal reveal-init">
                    <h3>Newly Added Feature: Favorites <span class="update-date" style="font-size:0.8em; opacity:0.7;">[2025-10-07]</span></h3>
                    <p>You can now mark your favorite channels with a star! Easily access them from the "Favorites" tab in the sidebar for quick viewing.</p>
                </div>

                <div class="update-item scroll-reveal reveal-init">
                    <h3>Now Playing Display <span class="update-date" style="font-size:0.8em; opacity:0.7;">[2025-10-07]</span></h3>
                    <p>You'll now see a "Now Playing" overlay at the top of the player, telling you exactly which channel is currently live. No more guessing!</p>
                </div>

                <div class="update-item scroll-reveal reveal-init">
                    <h3>New Channels Added! <span class="update-date" style="font-size:0.8em; opacity:0.7;">[2025-10-07]</span></h3>
                    <p>Our library is growing! We've just added 7 new international and local channels, bringing our total to 124. Discover them in the sidebar!</p>
                </div>

                <div class="update-item scroll-reveal reveal-init">
                    <h3>Major Platform Upgrade <span class="update-date" style="font-size:0.8em; opacity:0.7;">[2025-09-24]</span></h3>
                    <p>We've rolled out a significant update to improve streaming stability, reduce buffering, and enhance overall performance across all devices. Enjoy a smoother viewing experience!</p>
                </div>

                <div class="update-item scroll-reveal reveal-init">
                    <h3>New Channels Added! <span class="update-date" style="font-size:0.8em; opacity:0.7;">[2025-09-24]</span> </h3>
                    <p>We've expanded our library with 07 new international and local channels. Check them out in the sidebar category list.</p>
                </div>

                <div class="update-item scroll-reveal reveal-init">
                    <h3>Mobile UI Overhaul <span class="update-date" style="font-size:0.8em; opacity:0.7;">[2025-08-24]</span></h3>
                    <p>Our website is now fully responsive and optimized for mobile devices. The new layout ensures a great viewing experience whether you're on a desktop, tablet, or smartphone.</p>
                </div>

                <div class="update-item scroll-reveal reveal-init">
                    <h3>Search and Filtering Added <span class="update-date" style="font-size:0.8em; opacity:0.7;">[2025-07-24]</span></h3>
                    <p>Finding your favorite channel is now easier than ever! We've implemented a brand new search bar and category filters in the sidebar to help you navigate our growing channel list.</p>
                </div>

                <div class="update-item scroll-reveal reveal-init">
                    <h3>Official Launch <span class="update-date" style="font-size:0.8em; opacity:0.7;">[2025-07-24]</span></h3>
                    <p>Welcome to Shakzz TV! After months of development, our platform is now live. We're excited to provide a free, high-quality streaming service for everyone.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- PRIVACY POLICY SECTION (Alternating Animation) -->
    <section id="privacy-policy" class="info-section scroll-reveal reveal-init nav-scroll-target">
        <div class="container">
            <!-- Heading: POP UP -->
            <h2 class="lg-heading scroll-reveal reveal-init pop-up">Privacy Policy</h2>
            
            <!-- Zig-Zag Flow -->
            <p class="scroll-reveal reveal-init slide-left">At Shakzz TV, your privacy is paramount. This policy outlines how we collect, use, and protect your information. By using our service, you agree to the collection and use of information in accordance with this policy.</p>
            
            <h3 class="scroll-reveal reveal-init slide-right">Information We Collect</h3>
            <p class="scroll-reveal reveal-init slide-left">We collect non-personally identifiable information such as viewing habits, device type, browser information, and generalized location data to improve our service. We do not collect names, emails, or other direct personal identifiers without explicit consent.</p>
            
            <h3 class="scroll-reveal reveal-init slide-right">How We Use Information</h3>
            <ul class="scroll-reveal reveal-init slide-left">
                <li>Analyzing usage trends to enhance user experience.</li>
                <li>Optimizing streaming performance for different devices and regions.</li>
                <li>Understanding content popularity to guide channel acquisition.</li>
                <li>Troubleshooting technical issues and ensuring platform stability.</li>
            </ul>
            
            <h3 class="scroll-reveal reveal-init slide-right">Data Security</h3>
            <p class="scroll-reveal reveal-init slide-left">We implement reasonable safeguards to prevent unauthorized access, use, or disclosure of collected data.</p>
            
            <h3 class="scroll-reveal reveal-init slide-right">Third-Party Services</h3>
            <p class="scroll-reveal reveal-init slide-left">Our service uses third-party providers such as JW Player for streaming. They may collect data under their own policies. We do not share direct personal information.</p>
            
            <h3 class="scroll-reveal reveal-init slide-right">Changes to This Policy</h3>
            <p class="scroll-reveal reveal-init slide-left">We may update this policy periodically. Users will be notified of significant changes by posting them on this page.</p>
        </div>
    </section>

    <!-- CONTACT SECTION (Specific Animation) -->
    <section id="contact" class="info-section scroll-reveal reveal-init nav-scroll-target">
        <div class="container contact-container">
            
            <!-- Left Side (Social & Donations) -->
            <div class="contact-social">
                <!-- Heading: POP UP -->
                <h2 class="lg-heading scroll-reveal reveal-init pop-up">Get in Touch</h2>
                
                <!-- Content: Slides from LEFT -->
                <p class="scroll-reveal reveal-init slide-left">Connect with us on social media:</p>
                <div class="contact-links scroll-reveal reveal-init pop-up">
                    <a href="https://facebook.com/profile.php?id=100083316728361" target="_blank" class="social-link neon-bubble focusable-element">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://www.instagram.com/shakzzph?igsh=MTR4enRzbjJ4aWh5MQ==" target="_blank" class="social-link neon-bubble focusable-element">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="https://youtube.com/@Shakzz05" target="_blank" class="social-link neon-bubble focusable-element">
                        <i class="fab fa-youtube"></i>
                    </a>
                    <a href="https://www.tiktok.com/@shxkzz05?_r=1&_t=ZS-91WJJPgpWUe" target="_blank" class="social-link neon-bubble focusable-element">
                        <i class="fab fa-tiktok"></i>
                    </a>
                </div>
                <div class="donation-info">
                    <p class="donation-text scroll-reveal reveal-init slide-right">Your support helps keep this site running. Scan to donate via Gcash, Maya, or BPI.<br>Need help scanning? <br>Search for a QR tutorial on YouTube.</p>
                    <img src="BPIQR_Shakzz.png" alt="BPI QR Code for Donations" class="donation-qr-code scroll-reveal reveal-init pop-up" id="qrImage">
                    <p class="qr-zoom-text scroll-reveal reveal-init slide-right">Click picture to zoom</p>
                </div>
            </div>
            
            <!-- Right Side (Form) -->
            <div class="contact-form">
                <form id="contactForm" action="https://formspree.io/f/manpwdko" method="POST">
                    <!-- Title/Name: Label from Left, Input from Right -->
                    <label for="name" class="scroll-reveal reveal-init slide-left">Title / Name:</label>
                    <input type="text" id="name" name="name" placeholder="Your name or title" required class="focusable-element scroll-reveal reveal-init slide-right">
                    
                    <!-- Email: Label from Left, Input from Right -->
                    <label for="email" class="scroll-reveal reveal-init slide-left">Email Address:</label>
                    <input type="email" id="email" name="email" placeholder="Your email" required class="focusable-element scroll-reveal reveal-init slide-right">
                    
                    <!-- Message: Label from Left, Input from Right -->
                    <label for="message" class="scroll-reveal reveal-init slide-left">Description / Message:</label>
                    <textarea id="message" name="message" rows="5" placeholder="Write your message here..." required class="focusable-element scroll-reveal reveal-init slide-right"></textarea>
                    
                    <!-- Button: Pop-up -->
                    <button type="submit" class="focusable-element scroll-reveal reveal-init pop-up">Send</button>
                </form>
                <!-- Copyright moved here -->
                <p class="copyright-text">Â© 2025 Shakzz TV. All rights reserved.</p>
            </div>
        </div>
    </section>

    <div id="welcomeModal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-countdown" id="modalCountdown">5</span>
            <span class="close-button focusable-element" id="closeModalBtn" tabindex="0">Ã—</span>
            <h2 class="modal-heading">Welcome to Shakzz TV!</h2>
            <p class="modal-text">Enjoy a curated selection of local and international channels, available 24/7.</p>
        </div>
    </div>

    <div id="qrModal" class="modal-overlay">
        <div class="modal-content qr-modal-content">
            <span class="close-button focusable-element" id="closeQrModalBtn" tabindex="0">Ã—</span>
            <img src="https://placehold.co/500x500/FFFFFF/000000?text=SCAN+TO+DONATE" alt="Zoomed QR Code" id="zoomedQrImage">
        </div>
    </div>

    <button id="backToTopBtn" title="Go to top" class="focusable-element"><i class="fas fa-arrow-up"></i></button>

<script>
const channels = {
  PBBMain: {
    name: "PBB Main",
    type: "clearkey",
    manifestUri: "https://cdn-uw2-prod.tsv2.amagi.tv/linear/amg01006-abs-cbn-pbb-live-dash-abscbnono/index.mpd",
    logo: "https://i.imgur.com/n5rdR3v.png",
    group: ["entertainment"],
  },
  PBBDiningArea: {
    name: "PBB Dining Area",
    type: "clearkey",
    manifestUri: "https://abslive.akamaized.net/dash/live/2028025/pbb1/manifest.mpd",
    logo: "https://i.imgur.com/n5rdR3v.png",
    keyId: "b37bb823fe48452eba8cee62516f5da1",
    key: "8b48cec6bce94917e4c39c381d607102",
    group: ["entertainment"],
  },
  PBBPoolArea: {
    name: "PBB Pool Area",
    type: "clearkey",
    manifestUri: "https://abslive.akamaized.net/dash/live/2028025/pbb2/manifest.mpd",
    logo: "https://i.imgur.com/n5rdR3v.png",
    keyId: "9539027a7c42446a8648555af3bb3095",
    key: "1cb94c88f68bef1e728cfa4677e1eeca",
    group: ["entertainment"],
  },
  discoveryscience: {
    name: "Discovery Science",
    type: "clearkey",
    manifestUri: "https://d1g8wgjurz8via.cloudfront.net/bpk-tv/Discoveryscience2/default/manifest.mpd",
    keyId: "5458f45efedb4d6f8aa6ac76c85b621b",
    key: "dbf8a0a306a65345ba3012fd225370c0",
    logo: "  https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSkA_8vr9UZUhtkaFi6AshM83zQwhPWBGWX-Q&s",
    group: ["documentary"],
  },
  KidoodleTV: {
    name: "Kidoodle TV",
    type: "hls",
    manifestUri: "https://amg07653-apmc-amg07653c5-samsung-ph-8539.playouts.now.amagi.tv/playlist.m3u8",
    logo: "https://d1iiooxwdowqwr.cloudfront.net/pub/appsubmissions/20201230211817_FullLogoColor4x.png",
    group: ["cartoons & animations"],
  },
  StrawberryShortcake: {
    name: "Strawberry Shortcake",
    type: "hls",
    manifestUri: "https://d1si3n1st4nkgb.cloudfront.net/10000/88258006/hls/master.m3u8?ads.xumo_channelId=88258006",
    logo: "https://upload.wikimedia.org/wikipedia/en/f/ff/Strawberry_Shortcake_2003_Logo.png",
    group: ["cartoons & animations"],
  },
  SonictheHedgehog: {
    name: "Sonic the Hedgehog",
    type: "hls",
    manifestUri: "https://d1si3n1st4nkgb.cloudfront.net/10000/88258004/hls/master.m3u8?ads.xumo_channelId=88258004",
    logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1f/Sonic_The_Hedgehog.svg/1200px-Sonic_The_Hedgehog.svg.png",
    group: ["cartoons & animations"],
  },
  SuperMario: {
    name: "Super Mario",
    type: "hls",
    manifestUri: "https://d1si3n1st4nkgb.cloudfront.net/10000/88258005/hls/master.m3u8?ads.xumo_channelId=88258005",
    logo: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRFkMkkUmZBGslGWGZMN2er5emlnqGCCU49wg&s",
    group: ["cartoons & animations"],
  },
  Teletubbies: {
    name: "Teletubbies",
    type: "hls",
    manifestUri: "https://d1si3n1st4nkgb.cloudfront.net/10000/88258003/hls/master.m3u8?ads.xumo_channelId=88258003",
    logo: "https://upload.wikimedia.org/wikipedia/en/thumb/5/5a/Teletubbies_Logo.png/330px-Teletubbies_Logo.png",
    group: ["cartoons & animations"],
  },
  anione: {
    name: "Ani One",
    type: "hls",
    manifestUri: "https://amg19223-amg19223c9-amgplt0019.playout.now3.amagi.tv/playlist/amg19223-amg19223c9-amgplt0019/playlist.m3u8",
    logo: "https://www.medialink.com.hk/img/ani-one-logo.jpg",
    group: ["cartoons & animations"],
  }
};

// --- NEW: Force scroll top ---
window.onbeforeunload = () => window.scrollTo(0, 0);

// --- GLOBAL VARIABLES ---
let shownCount = 0;
let currentSearchFilter = "";
let currentChannelKey = "PBBMain"; 
const tabs = ["all", "favorites", "news", "entertainment", "movies", "sports", "documentary", "cartoons & animations"];
let currentTabIndex = 0;
let sortedChannels = [];
let focusedElement = null; // Holds the currently focused element for TV Remote logic

// --- 1. SCROLL REVEAL ANIMATION (Performance Optimized) ---
function setupScrollReveal() {
    const elements = document.querySelectorAll('.scroll-reveal');
    if (elements.length === 0) return;

    // Apply animation-ready class after delay to start staggered loading
    setTimeout(() => {
        document.body.classList.add('animations-ready');
    }, 500);

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('active');
                entry.target.classList.remove('reveal-init'); 
            } else if (document.body.classList.contains('animations-ready')) {
                entry.target.classList.remove('active');
                entry.target.classList.add('reveal-init');
            }
        });
    }, {
        root: null,
        threshold: 0.15,
        rootMargin: "0px 0px -50px 0px"
    });

    elements.forEach(el => observer.observe(el));
}

// --- 2. HELPER FUNCTIONS ---
function resetChannelListScroll() {
    const scrollableListContainer = document.querySelector(".scrollable-list");
    if (scrollableListContainer) scrollableListContainer.scrollTop = 0;
}

function getOrCreateDeviceId() {
    let deviceId = localStorage.getItem('deviceId');
    if (!deviceId) {
        deviceId = window.crypto?.randomUUID?.() || 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
            const r = Math.random() * 16 | 0;
            return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
        });
        localStorage.setItem('deviceId', deviceId);
    }
    return deviceId;
}

// --- 3. VIEWER COUNT ---
async function updateViewerCount() {
    try {
        const deviceId = getOrCreateDeviceId();
        const res = await fetch(`/api/viewers?deviceId=${deviceId}`);
        const data = await res.json();
        const viewerCountEl = document.getElementById('viewerCountText');
        if (viewerCountEl) viewerCountEl.innerText = data.count || 0;
    } catch (e) {
        // console.warn("Viewer count error (API might be offline)", e);
    }
}

// --- 4. FAVORITES STORAGE HANDLER ---
function loadFavoritesFromStorage() {
    const stored = JSON.parse(localStorage.getItem("favoriteChannels") || "[]");
    if (typeof channels !== 'undefined') {
        Object.entries(channels).forEach(([key, channel]) => {
            channel.favorite = stored.includes(key);
        });
    }
}

function saveFavoritesToStorage() {
    if (typeof channels === 'undefined') return;
    const favorites = Object.entries(channels)
        .filter(([key, ch]) => ch.favorite)
        .map(([key]) => key);
    localStorage.setItem("favoriteChannels", JSON.stringify(favorites));
}

function clearAllFavorites() {
    if (typeof channels !== 'undefined') {
        Object.values(channels).forEach(ch => ch.favorite = false);
    }
    localStorage.removeItem("favoriteChannels");
    renderChannelButtons(currentSearchFilter);
    console.log("All favorites have been cleared â­"); 
}

// --- 5. CHANNEL RENDERING ---
function renderChannelButtons(filter = "") {
    currentSearchFilter = filter;
    const list = document.getElementById("channelList");
    if (!list) return;
    list.innerHTML = "";
    shownCount = 0;

    if (typeof channels === 'undefined' || sortedChannels.length === 0) {
        list.innerHTML = "<p style='color:white; padding:10px; text-align:center;'>Loading channels...</p>";
        return;
    }

    const selectedGroup = tabs[currentTabIndex];
    const fragment = document.createDocumentFragment();

    sortedChannels.forEach(([key, channel]) => {
        const group = channel.group || "live";
        const matchesSearch = channel.name.toLowerCase().includes(filter.toLowerCase());
        const matchesFavorites = (selectedGroup === "favorites") ? channel.favorite === true : true;
        
        const matchesGroup =
            selectedGroup === "all" ||
            selectedGroup === "favorites" ||
            (Array.isArray(group) ? group.includes(selectedGroup) : group === selectedGroup);

        if (!matchesSearch || !matchesGroup || !matchesFavorites) return;

        const btn = document.createElement("button");
        btn.className = "channel-button focusable-element"; // Added focusable-element
        btn.setAttribute("data-key", key);

        const logo = document.createElement("img");
        logo.src = channel.logo;
        logo.alt = channel.name;
        logo.className = "channel-logo";
        logo.onerror = function() { this.style.backgroundColor = '#333'; this.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjIiPjxwYXRoIGQ9Ik0yMSA5djEwYTIgMiAwIDAgMS0yIDJNMTEgMTVhNSA1IDAgMSAwLTEwIDAgNSA1IDAgMCAwIDEwIDBtNSAyTDcgMTIiLz48L3N2Zz4='; };

        const nameSpan = document.createElement("span");
        nameSpan.className = "channel-name";
        nameSpan.textContent = channel.name;

        const favStar = document.createElement("span");
        favStar.className = "favorite-star";
        favStar.innerHTML = channel.favorite ? "â­" : "â˜†";
        favStar.onclick = (e) => {
            e.stopPropagation();
            channel.favorite = !channel.favorite;
            favStar.innerHTML = channel.favorite ? "â­" : "â˜†";
            saveFavoritesToStorage();
            renderChannelButtons(currentSearchFilter);
        };

        btn.appendChild(logo);
        btn.appendChild(nameSpan);
        btn.appendChild(favStar);
        btn.onclick = () => loadChannel(key);

        fragment.appendChild(btn);
        shownCount++;
    });

    list.appendChild(fragment);

    const countDisplay = document.getElementById("channelCountText");
    const channelCountContainer = document.getElementById("channelCount");
    if (countDisplay && channelCountContainer) {
        countDisplay.textContent = `${shownCount} channel${shownCount !== 1 ? "s" : ""} found`;
        if (shownCount > 0) channelCountContainer.classList.add("rainbow-text");
        else channelCountContainer.classList.remove("rainbow-text");
    }

    const clearBtnEls = document.querySelectorAll('#clearFavoritesBtn');
    clearBtnEls.forEach(btn => {
        if (!btn) return;
        btn.style.display = (selectedGroup === "favorites" && shownCount > 0) ? "block" : "none";
    });
}

// --- 6. LOAD CHANNEL ---
function loadChannel(key) {
    if (typeof channels === 'undefined') return;
    const channel = channels[key];
    if (!channel) return console.error(`Channel "${key}" not found`);

    currentChannelKey = key;

    const nowPlayingEl = document.getElementById("nowPlayingChannel");
    if (nowPlayingEl) {
        nowPlayingEl.textContent = channel.name;
        const overlay = document.getElementById("nowPlayingOverlay");
        if (overlay) {
            overlay.classList.add("now-playing-animate");
            setTimeout(() => overlay.classList.remove("now-playing-animate"), 350);
        }
    }

    const drmConfig = {};
    let playerType = "hls";

    if (channel.type === "widevine") {
        drmConfig.widevine = { url: channel.licenseServerUri };
        playerType = "dash";
    } else if (channel.type === "clearkey") {
        drmConfig.clearkey = { keyId: channel.keyId, key: channel.key };
        playerType = "dash";
    } else if (channel.type === "dash") {
        playerType = "dash";
    }

    if (window.jwplayer) {
        jwplayer("video").setup({
            file: channel.manifestUri,
            type: playerType,
            drm: Object.keys(drmConfig).length ? drmConfig : undefined,
            autostart: true,
            width: "100%",
            aspectratio: "16:9",
            stretching: "exactfit",
        });
        jwplayer("video").on("error", (e) => console.error("JWPlayer Error:", (e && e.message) || e));
    }
}

// --- 7. UI SETUP FUNCTIONS ---
function setupSearch() {
    const searchInput = document.getElementById("search");
    const clearBtn = document.getElementById("clearSearch");
    if (!searchInput || !clearBtn) return;

    searchInput.value = "";
    clearBtn.style.display = "none";

    searchInput.addEventListener("input", () => {
        const val = searchInput.value.trim();
        clearBtn.style.display = val ? "block" : "none";
        renderChannelButtons(val);
        resetChannelListScroll();
    });

    clearBtn.addEventListener("click", () => {
        searchInput.value = "";
        clearBtn.style.display = "none";
        renderChannelButtons("");
        resetChannelListScroll();
    });
}

function setupCategoryTabs() {
    const categoryButtonsDesktop = document.querySelector(".category-bar");
    const mobileCategoryList = document.getElementById("mobileCategoryList");
    
    // Generate category buttons dynamically for both views
    const renderCategoryButtons = (container, isMobile) => {
        if(!container) return;
        container.innerHTML = ''; // Clear existing

        tabs.forEach((tab, index) => {
            const btn = document.createElement('button');
            const isActive = index === 0;
            btn.className = isMobile ? `mobile-cat-option focusable-element ${isActive ? 'active' : ''}` : 
                                       `category-button focusable-element ${isActive ? 'active' : ''}`;
            btn.textContent = tab.charAt(0).toUpperCase() + tab.slice(1);
            
            btn.addEventListener("click", () => {
                currentTabIndex = index;
                // Update active state in both desktop bar and mobile modal
                document.querySelectorAll('.category-button, .mobile-cat-option').forEach(b => b.classList.remove("active"));
                
                // Set active state on desktop buttons
                const desktopBtn = document.querySelector(`.category-bar button:nth-child(${index + 1})`);
                if (desktopBtn) desktopBtn.classList.add("active");

                // Set active state on mobile buttons
                const mobileBtn = document.querySelector(`.mobile-category-list button:nth-child(${index + 1})`);
                if (mobileBtn) mobileBtn.classList.add("active");

                renderChannelButtons(currentSearchFilter);
                resetChannelListScroll();

                if (isMobile) {
                    document.getElementById('categoryModal').classList.remove('active');
                    const mobileBtnEl = document.getElementById('mobileCategoryBtn').querySelector('span');
                    mobileBtnEl.textContent = tab.charAt(0).toUpperCase() + tab.slice(1);
                }
            });
            container.appendChild(btn);
        });
    };

    renderCategoryButtons(categoryButtonsDesktop, false);
    renderCategoryButtons(mobileCategoryList, true);
    
    // Mobile Modal Setup
    const mobileCategoryBtn = document.getElementById("mobileCategoryBtn");
    const categoryModal = document.getElementById("categoryModal");
    const closeCategoryModal = document.getElementById("closeCategoryModal");

    if(mobileCategoryBtn && categoryModal && closeCategoryModal) {
        mobileCategoryBtn.addEventListener('click', () => categoryModal.classList.add('active'));
        closeCategoryModal.addEventListener('click', () => categoryModal.classList.remove('active'));
        categoryModal.addEventListener('click', (e) => {
            if (e.target === categoryModal) categoryModal.classList.remove('active');
        });
    }
}


function setupHamburgerMenu() {
    const hamburger = document.getElementById('hamburger');
    const mobileMenu = document.getElementById('navPages');
    const body = document.body;
    
    if (!hamburger || !mobileMenu) return;

    hamburger.addEventListener('click', () => {
        hamburger.classList.toggle('active');
        mobileMenu.classList.toggle('active');
        body.classList.toggle('mobile-menu-active'); // Toggle scroll lock
    });
    
    // Fix 1: Handle navigation click and scrolling
    mobileMenu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault(); 
            const targetId = link.getAttribute('href');
            const targetElement = document.querySelector(targetId);

            // Close the menu
            hamburger.classList.remove('active');
            mobileMenu.classList.remove('active');
            body.classList.remove('mobile-menu-active');
            
            // Immediately scroll to the element position compensating for the fixed header
            if (targetElement) {
                const headerHeight = document.querySelector('.page-header').offsetHeight;
                const topPos = targetElement.offsetTop - headerHeight; 
                window.scrollTo({ top: topPos, behavior: 'smooth' });
            } else if (targetId === "#main-content-area") {
                 window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });
    });
}

function setupWelcomeModal() {
    if (sessionStorage.getItem('welcomeModalShown')) return;
    const modal = document.getElementById('welcomeModal');
    const closeBtn = document.getElementById('closeModalBtn');
    const countdownSpan = document.getElementById('modalCountdown');

    if (!modal || !closeBtn || !countdownSpan) return;

    let countdown = 5;
    let countdownInterval;

    const closeModal = () => {
        modal.classList.remove('active');
        clearInterval(countdownInterval);
        sessionStorage.setItem('welcomeModalShown', 'true');
    };

    const startCountdown = () => {
        countdownSpan.textContent = countdown;
        countdownInterval = setInterval(() => {
            countdown--;
            countdownSpan.textContent = countdown;
            if (countdown <= 0) closeModal();
        }, 1000);
    };

    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
    document.querySelectorAll("nav a, .mobile-nav-pages a").forEach(link => {
        link.addEventListener("click", () => { if (modal.classList.contains('active')) closeModal(); });
    });

    modal.classList.add('active');
    startCountdown();
}

function setupQrCodeModal() {
    const qrCodeImage = document.querySelector('.donation-qr-code');
    const qrModal = document.getElementById('qrModal');
    const zoomedQrImage = document.getElementById('zoomedQrImage');
    const closeQrModalBtn = document.getElementById('closeQrModalBtn');

    if (!qrCodeImage || !qrModal || !zoomedQrImage || !closeQrModalBtn) return;

    qrCodeImage.addEventListener('click', () => {
        zoomedQrImage.src = qrCodeImage.src;
        qrModal.classList.add('active');
    });

    const closeModal = () => qrModal.classList.remove('active');
    closeQrModalBtn.addEventListener('click', closeModal);
    qrModal.addEventListener('click', (e) => { if (e.target === qrModal) closeModal(); });
}

function setupBackToTopButton() {
    const backToTopButton = document.getElementById('backToTopBtn');
    const aboutSection = document.getElementById('about-us');
    if (!backToTopButton || !aboutSection) return;

    window.addEventListener('scroll', () => {
        backToTopButton.classList.toggle('show', window.scrollY > aboutSection.offsetTop);
    });
    backToTopButton.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });
}

function setupNotificationSystem() {
    const banner = document.getElementById('liveNotificationBanner');
    const messageEl = document.getElementById('notificationMessage');
    const closeBtn = document.getElementById('closeNotificationBtn');
    const NOTIFICATION_URL = 'notification.json';
    const SESSION_KEY = 'notificationClosed';
    let currentNotificationId = null;

    if (!banner || !messageEl || !closeBtn) return;

    function showBanner(message, type = 'alert', autoHide = true) {
        messageEl.innerHTML = message;
        banner.classList.remove('info', 'success', 'alert', 'hide');
        banner.classList.add(type || 'alert');
        banner.style.display = 'flex';
        setTimeout(() => banner.classList.add('show'), 10);
        if (autoHide) setTimeout(() => hideBanner(), 8000);
    }

    function hideBanner() {
        banner.classList.remove('show');
        banner.classList.add('hide');
        setTimeout(() => (banner.style.display = 'none'), 400);
    }

    closeBtn.addEventListener('click', () => {
        hideBanner();
        sessionStorage.setItem(SESSION_KEY, currentNotificationId || 'true');
    });

    async function fetchNotification() {
        try {
            // This fetch will fail in a static environment, so we default to hidden or mock data if desired.
            const response = await fetch(`${NOTIFICATION_URL}?t=${Date.now()}`);
            if (!response.ok) throw new Error('Notification file not found.');
            const data = await response.json();
            const lastClosed = sessionStorage.getItem(SESSION_KEY);
            const shouldShow = data.show && (lastClosed !== data.id);
            currentNotificationId = data.id;
            if (shouldShow) showBanner(data.message, data.type);
            else hideBanner();
        } catch (error) {
            // console.warn('Could not load notification banner');
            hideBanner();
        }
    }

    fetchNotification();
    // RESTORED INTERVAL
    setInterval(fetchNotification, 60000); 
}

function setupScrollSpy() {
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.nav-pages a');
    const highlighter = document.querySelector('.nav-highlight');
    
    if (!highlighter) return;

    // Function to move the pill
    const moveHighlight = (link) => {
        highlighter.style.width = `${link.offsetWidth}px`;
        highlighter.style.left = `${link.offsetLeft}px`;
        highlighter.style.opacity = '1';
        
        // Update active class for text styling
        navLinks.forEach(l => l.classList.remove('active-link'));
        link.classList.add('active-link');
    };

    // Observer
    // Adjusted rootMargin to be more responsive on section entry
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const id = entry.target.getAttribute('id');
                const activeLink = document.querySelector(`.nav-pages a[href="#${id}"]`);
                if (activeLink) moveHighlight(activeLink);
            } else if (window.scrollY === 0) {
                 // Highlight Home button when scrolled all the way to the top
                const homeLink = document.querySelector('.nav-pages a[href="#main-content-area"]');
                if (homeLink) moveHighlight(homeLink);
            }
        });
    }, { rootMargin: '-50% 0px -40% 0px' }); // Use tighter vertical margins

    // Also observe the main content area for the "Home" state
    const mainContentArea = document.getElementById('main-content-area');
    if (mainContentArea) observer.observe(mainContentArea);
    sections.forEach(section => observer.observe(section));
}

// --- 8. TV REMOTE NAVIGATION LOGIC (CRITICAL FOR SMART TV) ---
function getFocusableElements() {
    const elements = document.querySelectorAll('.focusable-element:not([style*="display: none"]):not([disabled]):not([hidden]):not([aria-hidden="true"])');
    // Filter elements based on visibility, especially important for modals
    return Array.from(elements).filter(el => {
        const style = window.getComputedStyle(el);
        // Only return element if it's generally visible
        return style.visibility !== 'hidden' && style.opacity !== '0' && style.display !== 'none';
    });
}

function getElementLabel(el) {
    if (el.id === 'search') return 'Search Channel Input';
    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') return el.placeholder || (document.querySelector(`label[for="${el.id}"]`)?.textContent.trim() || el.id);
    if (el.tagName === 'BUTTON') return el.textContent.trim() || el.id;
    if (el.id === 'hamburger') return 'Open Mobile Menu';
    if (el.classList.contains('mobile-cat-option')) return 'Category: ' + el.textContent.trim();
    if (el.classList.contains('category-button')) return 'Category: ' + el.textContent.trim();
    if (el.classList.contains('channel-button')) return 'Channel: ' + el.querySelector('.channel-name')?.textContent.trim();
    if (el.classList.contains('social-link')) return 'Social Link: ' + el.querySelector('.fab').className.replace('fab fa-', '');
    if (el.classList.contains('click-here-link')) return 'Click Here CTA';
    if (el.id === 'closeModalBtn') return 'Close Welcome Message';
    if (el.id === 'closeCategoryModal') return 'Close Category Modal';
    if (el.id === 'closeQrModalBtn') return 'Close QR Zoom';
    if (el.id === 'backToTopBtn') return 'Back to Top';
    if (el.tagName === 'A') return el.textContent.trim() || el.getAttribute('href');
    return 'Element: ' + el.id || el.tagName;
}

function setTvFocus(el) {
    if (focusedElement) {
        focusedElement.classList.remove('tv-focus');
    }
    focusedElement = el;
    if (focusedElement) {
        focusedElement.classList.add('tv-focus');
        focusedElement.scrollIntoView({ block: 'nearest' });
        
        // NEW: Display debug/placeholder message for Smart TV control in console
        const message = "TV Focus: " + getElementLabel(focusedElement);
        console.log(message); 
        
        // Display on screen (in the nowPlayingOverlay area)
        const overlay = document.getElementById("nowPlayingChannel");
        if (overlay) {
            overlay.textContent = "TV Focus: " + getElementLabel(focusedElement);
            setTimeout(() => {
                 // Only restore if the element is not currently focused (preventing flicker)
                 if (focusedElement !== el) {
                     overlay.textContent = channels[currentChannelKey]?.name || "--";
                 }
            }, 3000); // Hide after 3 seconds
        }
    }
}

function clearTvFocus() {
    if (focusedElement) {
        focusedElement.classList.remove('tv-focus');
        focusedElement = null;
        
        // Restore Now Playing text
        const overlay = document.getElementById("nowPlayingChannel");
        if (overlay) {
             overlay.textContent = channels[currentChannelKey]?.name || "--";
        }
    }
}

function findNextFocus(direction) {
    const focusables = getFocusableElements();
    if (focusables.length === 0) return null;
    
    const currentIndex = focusedElement ? focusables.indexOf(focusedElement) : -1;
    let nextIndex = -1;

    // Default: find the geographically nearest element based on coordinates
    if (currentIndex === -1) {
        return focusables[0];
    }

    const currentRect = focusedElement.getBoundingClientRect();
    let bestCandidate = null;
    let minDistance = Infinity;

    for (let i = 0; i < focusables.length; i++) {
        if (i === currentIndex) continue;

        const candidate = focusables[i];
        const candidateRect = candidate.getBoundingClientRect();

        let isValidDirection = false;
        let distance = 0;

        // Simplified Directional Check (based on overlap and displacement)
        switch (direction) {
            case 'up':
                isValidDirection = candidateRect.bottom <= currentRect.top;
                distance = currentRect.top - candidateRect.bottom;
                break;
            case 'down':
                isValidDirection = candidateRect.top >= currentRect.bottom;
                distance = candidateRect.top - currentRect.bottom;
                break;
            case 'left':
                isValidDirection = candidateRect.right <= currentRect.left;
                distance = currentRect.left - candidateRect.right;
                break;
            case 'right':
                isValidDirection = candidateRect.left >= currentRect.right;
                distance = candidateRect.left - currentRect.right;
                break;
        }

        if (isValidDirection) {
            // Factor in horizontal/vertical alignment for "nearest"
            let misalignment = 0;
            if (direction === 'up' || direction === 'down') {
                 misalignment = Math.abs((currentRect.left + currentRect.right) / 2 - (candidateRect.left + candidateRect.right) / 2);
            } else {
                 misalignment = Math.abs((currentRect.top + currentRect.bottom) / 2 - (candidateRect.top + candidateRect.bottom) / 2);
            }
            
            // Weight the distance + misalignment (A star-like heuristic)
            const weightedDistance = distance * 0.7 + misalignment * 0.3;

            if (weightedDistance < minDistance) {
                minDistance = weightedDistance;
                bestCandidate = candidate;
            }
        }
    }

    // Fallback: If no clear directional match, move to the next logical element in the DOM (for linear lists like in the mobile menu)
    if (!bestCandidate) {
        if (direction === 'down' || direction === 'right') {
            nextIndex = (currentIndex + 1) % focusables.length;
        } else if (direction === 'up' || direction === 'left') {
            nextIndex = (currentIndex - 1 + focusables.length) % focusables.length;
        }
        return focusables[nextIndex];
    }
    
    return bestCandidate;
}


function setupTvRemoteLogic() {
    // Check if we are likely on a TV or using keyboard/remote controls (Desktop view has no hamburger)
    const isMobileView = window.matchMedia("(max-width: 992px)").matches;
    
    window.addEventListener('keydown', (e) => {
        const activeModal = document.querySelector('.modal-overlay.active');
        
        // 1. Handle Closing Modals (Back/Escape)
        if (e.key === 'Escape' || e.key === 'Backspace' || e.key === 'Back' || e.key === 'Exit') {
            // Handle closing logic (omitted for brevity, assume complex logic as in previous steps)
            e.preventDefault(); // Prevent browser back/close behavior
            
            // --- CLOSING LOGIC START ---
             // Close QR modal
            const qrModal = document.getElementById('qrModal');
            if (qrModal && qrModal.classList.contains('active')) {
                document.getElementById('closeQrModalBtn').click();
                return;
            }
            
            // Close Category modal
            const catModal = document.getElementById('categoryModal');
            if (catModal && catModal.classList.contains('active')) {
                document.getElementById('closeCategoryModal').click();
                return;
            }
            
            // Close Hamburger menu
            const mobileMenu = document.getElementById('navPages');
            if (mobileMenu && mobileMenu.classList.contains('active')) {
                document.getElementById('hamburger').click();
                return;
            }
            
            // Close Welcome modal (if still active)
            const welcomeModal = document.getElementById('welcomeModal');
             if (welcomeModal && welcomeModal.classList.contains('active')) {
                document.getElementById('closeModalBtn').click();
                return;
            }
            
            // Fallback: Go to main player area
            if (window.scrollY > 0) {
                 window.scrollTo({ top: 0, behavior: 'smooth' });
                 return;
            }
            // --- CLOSING LOGIC END ---
        }


        // 2. Handle Navigation (Arrows/Enter)
        let direction = null;
        switch (e.key) {
            case 'ArrowUp':
            case 'Up':
                direction = 'up';
                break;
            case 'ArrowDown':
            case 'Down':
                direction = 'down';
                break;
            case 'ArrowLeft':
            case 'Left':
                direction = 'left';
                break;
            case 'ArrowRight':
            case 'Right':
                direction = 'right';
                break;
            case 'Enter':
            case 'Select':
                if (focusedElement) {
                    // Check if focused element is an input and hit enter
                    if (focusedElement.tagName === 'INPUT' || focusedElement.tagName === 'TEXTAREA') {
                        return; // Allow native input interaction
                    }
                    focusedElement.click(); // Trigger click event on focused element
                    e.preventDefault();
                } else {
                    // If no focus, attempt to focus the sidebar search/first channel
                    if (!isMobileView) {
                        setTvFocus(document.getElementById('search') || document.querySelector('.channel-button'));
                    }
                }
                return;
        }

        if (direction) {
            e.preventDefault(); // Prevent default browser scroll
            const nextElement = findNextFocus(direction);
            
            if (nextElement) {
                setTvFocus(nextElement);
                // Ensure visibility (especially for channel list)
                nextElement.scrollIntoView({ behavior: 'smooth', block: 'center' }); 
            }
        }
    });
    
    // Initial Focus setup
    window.addEventListener('load', () => {
         // Focus the search input or first nav link initially
        const searchInput = document.getElementById('search');
        if (searchInput) {
            setTvFocus(searchInput);
        } else {
            const firstLink = document.querySelector('.nav-pages a');
            if(firstLink) setTvFocus(firstLink);
        }
    });
}

// --- 9. MAIN INITIALIZATION ---
document.addEventListener('DOMContentLoaded', () => {
    
    // A. Always setup static UI elements 
    setupScrollReveal(); 
    setupSearch();
    setupCategoryTabs();
    setupWelcomeModal();
    setupHamburgerMenu(); 
    setupBackToTopButton();
    setupQrCodeModal();
    setupNotificationSystem();
    setupScrollSpy();
    setupTvRemoteLogic(); // NEW: Smart TV Remote Logic

    // B. Setup Clear Favorites Button
    const clearFavBtn = document.getElementById("clearFavoritesBtn");
    if (clearFavBtn) {
        clearFavBtn.addEventListener('click', clearAllFavorites);
    }

    // C. Load Channel Data (Safe check)
    if (typeof channels !== 'undefined') {
        sortedChannels = Object.entries(channels).sort((a, b) => a[1].name.localeCompare(b[1].name));
        loadFavoritesFromStorage();
        renderChannelButtons();
        resetChannelListScroll();
        if (channels[currentChannelKey]) loadChannel(currentChannelKey);
    } else {
        console.error("Channels data not loaded! Animations will still work.");
    }

    // D. Periodic Updates
    updateViewerCount();
    setInterval(updateViewerCount, 5000);
});
</script>
</body>
</html>
